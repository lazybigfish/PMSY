# 任务列表到期高亮功能实现记录

## 实现时间
2026-02-12

## 需求描述
任务中心列表中：
1. **默认筛选**：只显示未完成的任务（排除 `done` 已完成状态）
2. **高亮显示**：对于即将到期的任务要高亮显示（黄色）
3. **醒目显示**：对于已经超期未完成的，要醒目显示（红色）

## 修改文件
1. `src/pages/tasks/TaskList.tsx` - 默认排除已完成任务的筛选逻辑
2. `src/pages/tasks/components/TaskTable.tsx` - 列表视图高亮显示
3. `src/pages/tasks/components/TaskKanban.tsx` - 看板视图高亮显示

## 实现内容

### 1. 默认筛选逻辑（TaskList.tsx）

修改筛选逻辑，当用户未手动选择状态时，默认排除已完成的任务：

```typescript
// 状态筛选 - 默认排除已完成的任务（done）
if (filters.statuses.length > 0) {
  // 如果用户手动选择了状态，按用户选择筛选
  if (!filters.statuses.includes(task.status)) {
    return false;
  }
} else {
  // 默认排除已完成的任务
  if (task.status === 'done') {
    return false;
  }
}
```

### 2. 到期判断辅助函数

在 TaskTable.tsx 和 TaskKanban.tsx 中都添加了相同的辅助函数：

```typescript
// 判断任务是否即将到期（3天内）
const isDueSoon = (task: Task): boolean => {
  if (!task.due_date || task.status === 'done') return false;
  const due = new Date(task.due_date);
  const now = new Date();
  now.setHours(0, 0, 0, 0);
  const threeDaysLater = new Date(now);
  threeDaysLater.setDate(now.getDate() + 3);
  threeDaysLater.setHours(23, 59, 59, 999);

  return due >= now && due <= threeDaysLater;
};

// 判断任务是否已超期
const isOverdue = (task: Task): boolean => {
  if (!task.due_date || task.status === 'done') return false;
  const due = new Date(task.due_date);
  const now = new Date();
  now.setHours(0, 0, 0, 0);
  return due < now;
};
```

### 3. 列表视图高亮（TaskTable.tsx）

#### 行样式
- **已超期**：淡红色背景 + 红色左边框 (`bg-red-50/60 border-l-4 border-l-red-500`)
- **即将到期**：淡黄色背景 + 黄色左边框 (`bg-yellow-50/60 border-l-4 border-l-yellow-400`)
- **正常**：无特殊样式

#### 截止日期样式
- **已超期**：红色文字 + 警告图标 (`AlertCircle`)
- **即将到期**：深黄色文字 + 时钟图标 (`Clock`)
- **正常**：默认灰色文字

### 4. 看板视图高亮（TaskKanban.tsx）

#### 卡片边框样式
- **已超期**：红色边框 (`border-red-400`)
- **即将到期**：黄色边框 (`border-yellow-400`)
- **正常**：灰色边框 (`border-gray-100`)

#### 截止日期显示
- **已超期**：红色文字 + 警告图标
- **即将到期**：深黄色文字 + 时钟图标
- **正常**：灰色文字 + 时钟图标

## 视觉效果

### 列表视图
| 状态 | 背景 | 左边框 | 日期文字 | 图标 |
|------|------|--------|----------|------|
| 已超期 | 淡红色 | 红色 | 红色粗体 | 警告图标 |
| 即将到期 | 淡黄色 | 黄色 | 深黄色 | 时钟图标 |
| 正常 | 白色 | 无 | 灰色 | 无 |

### 看板视图
| 状态 | 卡片边框 | 日期文字 | 图标 |
|------|----------|----------|------|
| 已超期 | 红色 | 红色粗体 | 警告图标 |
| 即将到期 | 黄色 | 深黄色 | 时钟图标 |
| 正常 | 灰色 | 灰色 | 时钟图标 |

## 优先级规则
已超期 > 即将到期
- 如果任务已超期，显示红色（即使也在"即将到期"范围内）
- 如果任务即将到期但未超期，显示黄色

## 验收结果
- [x] 页面默认只显示未完成的任务（排除已完成）
- [x] 即将到期的任务（3天内）显示黄色高亮
- [x] 已超期未完成的任务显示红色醒目提示
- [x] 已完成的任务不显示任何高亮
- [x] 列表视图和看板视图都支持
- [x] 优先级正确：超期优先于即将到期
- [x] 类型检查通过

## 注意事项
- 已完成的任务（`done` 状态）不会显示高亮，无论是否超期
- 默认筛选排除了已完成任务，但用户可以通过筛选器手动选择显示
- 时间计算以当天零点为基准
