# 任务列表到期高亮显示需求文档

## 需求时间
2026-02-12

## 需求描述
任务中心列表中：
1. **默认筛选**：只显示未完成的任务（排除 `done` 已完成状态）
2. **高亮显示**：对于即将到期的任务要高亮显示
3. **醒目显示**：对于已经超期未完成的，要醒目显示

## 需求分析

### 1. 任务状态定义
任务状态包括：
- `todo` - 待办
- `in_progress` - 进行中
- `paused` - 已暂停
- `done` - 已完成
- `canceled` - 已取消

**注意**：已完成的任务（`done`）不需要高亮显示，无论是否超期。

### 2. 到期时间定义

#### 即将到期（高亮显示 - 黄色）
- **定义**：截止日期在未来 3 天内（含今天）
- **条件**：
  - 任务状态不是 `done`（已完成）
  - 截止日期存在且有效
  - 截止日期在今天或未来 3 天内
  - 截止日期未超期

#### 已超期未完成（醒目显示 - 红色）
- **定义**：截止日期已过，但任务未完成
- **条件**：
  - 任务状态不是 `done`（已完成）
  - 截止日期存在且有效
  - 截止日期早于今天

### 3. 优先级
已超期 > 即将到期
- 如果任务已超期，显示红色（即使也在"即将到期"范围内）
- 如果任务即将到期但未超期，显示黄色

## 视觉效果设计

### 列表视图（TaskTable）
**即将到期**：
- 行背景：淡黄色 (`bg-yellow-50`)
- 截止日期文字：深黄色 (`text-yellow-700`)
- 可选：左侧边框黄色标记

**已超期**：
- 行背景：淡红色 (`bg-red-50`)
- 截止日期文字：红色 (`text-red-600`)
- 可选：左侧边框红色标记、火焰图标

### 看板视图（TaskKanban）
**即将到期**：
- 卡片边框：黄色 (`border-yellow-400`)
- 截止日期：深黄色文字 + 时钟图标

**已超期**：
- 卡片边框：红色 (`border-red-400`)
- 截止日期：红色文字 + 警告图标

## 技术实现方案

### 辅助函数
```typescript
// 判断任务是否即将到期（3天内）
const isDueSoon = (task: Task): boolean => {
  if (!task.due_date || task.status === 'done') return false;
  const due = new Date(task.due_date);
  const now = new Date();
  const threeDaysLater = new Date(now);
  threeDaysLater.setDate(now.getDate() + 3);
  threeDaysLater.setHours(23, 59, 59, 999);
  
  return due >= now && due <= threeDaysLater;
};

// 判断任务是否已超期
const isOverdue = (task: Task): boolean => {
  if (!task.due_date || task.status === 'done') return false;
  const due = new Date(task.due_date);
  const now = new Date();
  return due < now;
};
```

### 样式类名映射
```typescript
const getTaskRowClass = (task: Task): string => {
  if (isOverdue(task)) {
    return 'bg-red-50 border-l-4 border-l-red-500';
  }
  if (isDueSoon(task)) {
    return 'bg-yellow-50 border-l-4 border-l-yellow-400';
  }
  return '';
};
```

## 默认筛选逻辑
- 页面加载时，默认只显示未完成状态的任务
- 排除状态：`done`（已完成）
- 保留状态：`todo`、`in_progress`、`paused`、`canceled`
- 用户可以通过筛选器手动切换显示已完成任务

## 相关文件
- `src/pages/tasks/TaskList.tsx` - 任务列表主页面（默认筛选逻辑）
- `src/pages/tasks/components/TaskTable.tsx` - 列表视图
- `src/pages/tasks/components/TaskKanban.tsx` - 看板视图

## 验收标准
- [ ] 页面默认只显示未完成的任务（排除已完成）
- [ ] 即将到期的任务（3天内）显示黄色高亮
- [ ] 已超期未完成的任务显示红色醒目提示
- [ ] 已完成的任务不显示任何高亮
- [ ] 列表视图和看板视图都支持
- [ ] 优先级正确：超期优先于即将到期
