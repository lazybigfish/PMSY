# 任务列表默认排序功能实现记录

## 实现时间
2026-02-12

## 需求描述
任务列表的默认排序是按照优先级，然后按照时间快到期优先排上面。

## 修改文件
- `src/pages/tasks/TaskList.tsx` - 任务列表默认排序逻辑

## 实现内容

### 1. 优先级权重映射
```typescript
const priorityWeight: Record<string, number> = {
  urgent: 4,
  high: 3,
  medium: 2,
  low: 1
};
```

### 2. 默认排序逻辑
在 `filteredTasks` 的 `useMemo` 中添加排序逻辑：

```typescript
// 默认排序：按优先级降序，然后按截止日期升序（快到期的在前）
return filtered.sort((a, b) => {
  // 第一优先级：按优先级权重降序
  const priorityA = priorityWeight[a.priority || 'medium'];
  const priorityB = priorityWeight[b.priority || 'medium'];
  const priorityDiff = priorityB - priorityA;
  if (priorityDiff !== 0) return priorityDiff;

  // 第二优先级：按截止日期升序（快到期的在前）
  if (!a.due_date && !b.due_date) return 0;
  if (!a.due_date) return 1;  // a 无日期，排后面
  if (!b.due_date) return -1; // b 无日期，排后面

  return new Date(a.due_date).getTime() - new Date(b.due_date).getTime();
});
```

## 排序规则

### 第一优先级：优先级（降序）
优先级从高到低：
1. `urgent` (4) - 紧急
2. `high` (3) - 高
3. `medium` (2) - 中
4. `low` (1) - 低

### 第二优先级：截止日期（升序）
在同一优先级内：
- 截止日期早的任务排在前面
- 没有截止日期的任务排在同优先级的最后

## 排序示例

输入任务：
| 任务 | 优先级 | 截止日期 |
|------|--------|----------|
| 任务A | high | 2026-02-15 |
| 任务B | urgent | 2026-02-20 |
| 任务C | high | 2026-02-10 |
| 任务D | medium | 2026-02-12 |
| 任务E | urgent | 2026-02-08 |
| 任务F | high | 无 |

排序后：
1. 任务E (urgent, 2026-02-08)
2. 任务B (urgent, 2026-02-20)
3. 任务C (high, 2026-02-10)
4. 任务A (high, 2026-02-15)
5. 任务F (high, 无)
6. 任务D (medium, 2026-02-12)

## 验收结果
- [x] 默认按优先级降序排列（紧急 > 高 > 中 > 低）
- [x] 同一优先级内按截止日期升序排列（快到期的在前）
- [x] 无截止日期的任务排在同优先级的最后
- [x] 类型检查通过

## 注意事项
- 默认排序会在筛选后自动应用
- 用户仍可通过表头点击切换其他排序方式（如果实现了的话）
- 排序是稳定的，相同优先级和截止日期的任务保持原有顺序
