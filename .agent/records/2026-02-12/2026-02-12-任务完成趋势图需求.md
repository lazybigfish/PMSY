# 任务完成趋势图需求文档

## 需求时间
2026-02-12

## 需求描述
在任务搜索栏和任务统计卡片之间，放一条横线的轴，上面有 15 个节点，每个节点上显示一天处理完成的任务，然后再很轴上方连成曲线，时间轴的第 14 节点永远显示当天的数据，前面都是历史曲线。

## 需求分析

### 1. 位置
- 位于任务搜索栏（TaskFilterBar）和任务统计卡片（Stats）之间

### 2. 时间轴设计
- **节点数量**：15 个节点
- **时间范围**：从今天往前推 14 天（共 15 天）
- **第 14 节点**：显示当天（今天）的数据
- **前面 13 个节点**：显示历史数据（过去 13 天）

### 3. 数据展示
- **节点数据**：每天处理完成的任务数量
- **数据来源**：统计 `status = 'done'` 的任务
- **时间字段**：使用 `completed_at` 字段（任务完成时间）

### 4. 视觉效果
- **横线**：作为时间轴基线
- **节点**：15 个圆点均匀分布在横线上
- **数字**：每个节点上方显示该天完成的任务数
- **曲线**：用平滑曲线连接各节点，展示任务完成趋势
- **今天标记**：第 14 节点（今天）可以特殊标记

## 技术实现方案

### 数据计算
```typescript
// 生成过去15天的日期数组
const generateDateRange = (): Date[] => {
  const dates: Date[] = [];
  const today = new Date();
  today.setHours(0, 0, 0, 0);
  
  for (let i = 14; i >= 0; i--) {
    const date = new Date(today);
    date.setDate(today.getDate() - i);
    dates.push(date);
  }
  return dates;
};

// 统计每天完成的任务数
const calculateDailyCompleted = (tasks: Task[], dates: Date[]): number[] => {
  return dates.map(date => {
    const nextDay = new Date(date);
    nextDay.setDate(date.getDate() + 1);
    
    return tasks.filter(task => {
      if (task.status !== 'done' || !task.completed_at) return false;
      const completedAt = new Date(task.completed_at);
      return completedAt >= date && completedAt < nextDay;
    }).length;
  });
};
```

### 曲线绘制
使用 SVG 绘制平滑曲线：
```typescript
// 计算贝塞尔曲线路径
const generateSmoothPath = (points: { x: number; y: number }[]): string => {
  if (points.length < 2) return '';
  
  let path = `M ${points[0].x} ${points[0].y}`;
  
  for (let i = 1; i < points.length; i++) {
    const prev = points[i - 1];
    const curr = points[i];
    const cpx1 = prev.x + (curr.x - prev.x) / 2;
    const cpy1 = prev.y;
    const cpx2 = prev.x + (curr.x - prev.x) / 2;
    const cpy2 = curr.y;
    path += ` C ${cpx1} ${cpy1}, ${cpx2} ${cpy2}, ${curr.x} ${curr.y}`;
  }
  
  return path;
};
```

## 组件结构
```typescript
{/* 任务完成趋势图 */}
<div className="bg-white rounded-xl p-6 shadow-sm border border-dark-100">
  <h3 className="text-sm font-medium text-dark-700 mb-4">近15天任务完成趋势</h3>
  <div className="relative h-32">
    {/* SVG 曲线图 */}
    <svg className="w-full h-full">
      {/* 曲线 */}
      <path d={smoothPath} fill="none" stroke="url(#gradient)" strokeWidth="2" />
      {/* 渐变定义 */}
      <defs>
        <linearGradient id="gradient" x1="0%" y1="0%" x2="100%" y2="0%">
          <stop offset="0%" stopColor="#6366f1" />
          <stop offset="100%" stopColor="#8b5cf6" />
        </linearGradient>
      </defs>
    </svg>
    
    {/* 节点和数字 */}
    {dataPoints.map((point, index) => (
      <div
        key={index}
        className="absolute flex flex-col items-center"
        style={{ left: `${point.x}%`, bottom: '20px' }}
      >
        {/* 数字 */}
        <span className="text-xs font-semibold text-dark-700 mb-1">
          {point.value}
        </span>
        {/* 节点 */}
        <div className={`w-2 h-2 rounded-full ${
          index === 14 ? 'bg-primary-500' : 'bg-dark-300'
        }`} />
        {/* 日期标签 */}
        <span className="text-xs text-dark-400 mt-1">
          {index === 14 ? '今天' : formatDate(point.date)}
        </span>
      </div>
    ))}
    
    {/* 横线 */}
    <div className="absolute bottom-5 left-0 right-0 h-px bg-dark-200" />
  </div>
</div>
```

## 相关文件
- `src/pages/tasks/TaskList.tsx` - 任务列表主页面

## 验收标准
- [ ] 显示15个节点，均匀分布在横线上
- [ ] 第14节点显示当天数据，前面显示历史数据
- [ ] 每个节点上方显示该天完成的任务数
- [ ] 用平滑曲线连接各节点
- [ ] 今天节点有特殊标记
- [ ] 响应式适配不同屏幕宽度
