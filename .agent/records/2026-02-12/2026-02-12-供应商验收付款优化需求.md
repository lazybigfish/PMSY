# 供应商验收记录与付款管理优化需求

## 需求概述

优化供应商详情页中的验收记录和付款管理功能，提升操作效率和页面空间利用率。

---

## 需求详情

### 1. 验收记录新增流程优化

#### 现状问题
- 当前点击"新增验收"没有实际功能
- 验收类型不明确，用户无法区分初验、终验、阶段性验收

#### 优化方案
点击"新增验收"按钮时，弹出选择对话框：

**步骤1：选择验收类型**
- 初验（initial）
- 终验（final）
- 阶段性验收（phase）

**步骤2：选择验收日期**
- 使用日期选择器

**步骤3：确认保存**
- 验收结果默认为"通过"
- 快速完成验收记录创建

#### 数据结构变更
需要在 `supplier_acceptances` 表中增加 `acceptance_type` 字段：
```sql
acceptance_type: 'initial' | 'final' | 'phase'
```

---

### 2. 验收记录与付款管理页面合并

#### 现状问题
- 验收记录和付款管理分为两个 Tab 页面
- 空间利用率低，用户需要在两个页面间切换

#### 优化方案
将"验收记录"和"付款管理"合并为一个"验收与付款"页面：

**页面布局：**
```
┌─────────────────────────────────────────────────────────┐
│  验收与付款                                              │
├─────────────────────────────────────────────────────────┤
│  [统计卡片区域]                                          │
│  ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────────┐   │
│  │ 合同金额  │ │ 已支付金额│ │ 未支付金额│ │ 未支付比例│   │
│  │ ¥100,000 │ │ ¥50,000  │ │ ¥50,000  │ │  50.0%   │   │
│  └──────────┘ └──────────┘ └──────────┘ └──────────┘   │
├─────────────────────────────┬───────────────────────────┤
│                             │                           │
│   验收记录                   │   付款管理                 │
│   ┌─────────────────────┐   │   ┌─────────────────────┐ │
│   │ [+ 新增验收]         │   │   │ [+ 新增付款计划]     │ │
│   ├─────────────────────┤   │   ├─────────────────────┤ │
│   │ 🟢 终验 - 2024-01-15│   │   │ 1. 首付款           │ │
│   │ 🟡 初验 - 2024-01-10│   │   │    ¥50,000 (已付)   │ │
│   │ ...                 │   │   │ 2. 二期款           │ │
│   └─────────────────────┘   │   │    ¥30,000 (待付)   │ │
│                             │   │ ...                 │ │
│                             │   └─────────────────────┘ │
└─────────────────────────────┴───────────────────────────┘
```

**顶部：统计卡片区域（保留原付款页面统计）**
- 合同金额
- 已支付金额
- 未支付金额
- 未支付比例

**下方左右分栏：**

**左侧：验收记录区域**
- 显示验收类型标签（初验/终验/阶段性验收）
- 显示验收日期
- 显示验收结果（通过/不通过）
- 支持新增验收

**右侧：付款管理区域**
- 保留现有付款计划表格功能
- 支持新增付款计划
- 支持确认付款/撤回付款

---

### 3. 基本信息页面验收状态联动

#### 现状问题
- 基本信息页面的"是否验收"卡片显示逻辑简单（只要有验收记录就显示"已验收"）
- 无法反映真实的验收状态（初验/终验）

#### 优化方案
**验收状态显示规则：**

| 验收记录情况 | 是否验收卡片显示 |
|-------------|----------------|
| 无任何验收记录 | 未验收（灰色） |
| 只有初验记录 | 初验完成（蓝色） |
| 只有阶段性验收 | 阶段性验收（黄色） |
| 有终验记录 | 终验完成（绿色） |
| 有终验+其他 | 终验完成（绿色） |

**显示内容：**
- 主状态：未验收 / 初验完成 / 阶段性验收 / 终验完成
- 副标题：显示最新一次验收的日期和类型
- 记录数：共 X 条验收记录

**联动逻辑：**
- 当在"验收与付款"页面新增/删除验收记录时
- 基本信息页面的验收状态卡片实时更新

---

## 技术方案

### 数据库变更
```sql
-- 为验收记录表增加类型字段
ALTER TABLE supplier_acceptances ADD COLUMN acceptance_type VARCHAR(20) 
  CHECK (acceptance_type IN ('initial', 'final', 'phase'));

-- 为已有数据设置默认值
UPDATE supplier_acceptances SET acceptance_type = 'phase' WHERE acceptance_type IS NULL;
```

### 前端修改
1. 修改 `SupplierDetailModal.tsx`：
   - 删除独立的 `acceptance` 和 `payment` Tab
   - 新增合并后的 `acceptance-payment` Tab
   - 创建新的合并页面组件

2. 新增验收弹窗组件：
   - 选择验收类型（单选）
   - 选择验收日期
   - 确认按钮

3. 类型定义更新：
   - `SupplierAcceptance` 接口增加 `acceptance_type` 字段

---

## 验收标准

### 验收记录新增
- [ ] 点击"新增验收"弹出选择验收类型的对话框
- [ ] 可以选择初验、终验、阶段性验收三种类型
- [ ] 选择日期后可以保存验收记录
- [ ] 验收记录正确显示类型标签

### 页面合并
- [ ] 验收记录和付款管理显示在同一个页面
- [ ] 顶部保留统计卡片（合同金额、已支付、未支付、比例）
- [ ] 左右分栏布局，空间利用合理
- [ ] 付款管理功能保持原有功能完整
- [ ] 页面响应式适配

### 状态联动
- [ ] 基本信息页面的"是否验收"卡片根据验收记录动态显示
- [ ] 无记录时显示"未验收"（灰色）
- [ ] 有初验时显示"初验完成"（蓝色）
- [ ] 有终验时显示"终验完成"（绿色）
- [ ] 显示最新验收日期和记录总数
- [ ] 新增/删除验收记录后基本信息页面实时更新
