# 日期选择器优化功能实现记录

## 实现时间
2026-02-12

## 需求概述
优化全局日期选择控件，提升用户体验：
1. 点击整个输入框即可打开日期选择弹窗
2. 增加快捷日期选项（今天、明天、三天后、一周后、一月后、三月后）

## 实现内容

### 1. 创建全局 DatePicker 组件
**文件路径：** `src/components/DatePicker.tsx`

**组件特性：**
- 点击整个输入框区域打开日期选择弹窗
- 快捷日期选项：今天、明天、三天后、一周后、一月后、三月后
- 月份切换（左右箭头导航）
- 日历网格显示当前月份
- 高亮选中日期和今天日期
- 支持清除已选日期
- 点击弹窗外区域自动关闭
- 与系统UI风格保持一致

**Props 接口：**
```typescript
interface DatePickerProps {
  value: string;           // 当前值 (YYYY-MM-DD 格式)
  onChange: (date: string) => void;  // 变更回调
  placeholder?: string;    // 占位文本
  required?: boolean;      // 是否必填
  className?: string;      // 自定义类名
  min?: string;           // 最小日期
  max?: string;           // 最大日期
}
```

### 2. 替换所有日期输入

已更新的文件列表：

| 文件路径 | 说明 |
|---------|------|
| `src/pages/tasks/TaskCreatePage.tsx` | 创建任务页面 - 截止日期 |
| `src/pages/tasks/components/TaskCreateModal.tsx` | 创建任务弹窗 - 截止日期 |
| `src/pages/tasks/components/TaskFilterBar.tsx` | 任务筛选栏 - 时间范围筛选 |
| `src/pages/tasks/components/AdvancedSearch.tsx` | 高级搜索 - 日期条件 |
| `src/pages/projects/components/SupplierDetailModal.tsx` | 供应商详情 - 付款时间、实际付款时间 |

### 3. 使用方法

```tsx
import { DatePicker } from '../../components/DatePicker';

// 基础用法
<DatePicker
  value={formData.due_date}
  onChange={(date) => setFormData({ ...formData, due_date: date })}
  placeholder="选择截止日期"
  required
/>

// 带自定义类名
<DatePicker
  value={startDate}
  onChange={(date) => setStartDate(date)}
  placeholder="开始日期"
  className="flex-1"
/>
```

## 界面效果

### 快捷日期选项
- 今天
- 明天
- 三天后
- 一周后
- 一月后
- 三月后

### 日历功能
- 月份导航（左右箭头）
- 星期标题（日、一、二、三、四、五、六）
- 日期网格
- 选中日期高亮（主题色背景）
- 今天日期标识（主题色边框）

### 底部操作
- 今天按钮（快速选择今天）
- 清除按钮（清空已选日期）

## 技术实现

### 核心逻辑
1. **日期计算：** 使用原生 Date API 进行日期计算
2. **弹窗控制：** React state 管理弹窗显示/隐藏
3. **外部点击关闭：** useEffect 监听 mousedown 事件
4. **月份切换：** 通过 setMonth 调整当前显示月份

### 快捷日期计算
```typescript
const handleQuickDateSelect = (days: number) => {
  const date = new Date();
  date.setDate(date.getDate() + days);
  const dateStr = formatDate(date);
  onChange(dateStr);
  setCurrentMonth(new Date(date));
  setIsOpen(false);
};
```

### 日历渲染
```typescript
const renderCalendar = () => {
  const year = currentMonth.getFullYear();
  const month = currentMonth.getMonth();
  const daysInMonth = getDaysInMonth(year, month);
  const firstDay = getFirstDayOfMonth(year, month);
  
  // 渲染空白占位 + 日期按钮
};
```

## 验收结果

- [x] 点击输入框任意位置都能打开日期选择弹窗
- [x] 快捷日期按钮（今天、明天、三天后、一周后、一月后、三月后）正常工作
- [x] 日历可以正常切换月份
- [x] 可以正常选择日期并回填到输入框
- [x] 可以清除已选日期
- [x] 弹窗外点击可以关闭弹窗
- [x] 所有使用日期选择的地方都已替换为新组件
- [x] 编译通过，无错误

## 相关文件

- 需求文档：`.agent/records/2026-02-12-日期选择器优化需求.md`
- 组件文件：`src/components/DatePicker.tsx`
