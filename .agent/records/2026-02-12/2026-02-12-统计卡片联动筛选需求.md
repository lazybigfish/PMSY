# 统计卡片联动筛选需求文档

## 需求时间
2026-02-12

## 需求描述
任务中心上面的统计卡片有实际联动效果，点击总任务、我负责的、我参与的、已完成等，根据卡片上的信息去筛选下面列表展示的内容。

## 需求分析

### 1. 统计卡片与筛选逻辑对应关系

| 统计卡片 | 筛选条件 | 说明 |
|---------|---------|------|
| **总任务** | 重置所有筛选 | 显示所有任务，清除其他筛选条件 |
| **我负责的** | 当前用户为主要负责人 | `assignees` 中存在 `user_id === currentUser.id` 且 `is_primary === true` |
| **我参与的** | 当前用户为参与人（非主要） | `assignees` 中存在 `user_id === currentUser.id` 且 `is_primary === false` |
| **已完成** | 状态为 `done` | `status === 'done'` |
| **截止本周** | 本周内到期且未完成 | `due_date` 在本周内且 `status !== 'done'` |
| **截止本月** | 本月内到期且未完成 | `due_date` 在本月内且 `status !== 'done'` |
| **超期未完成** | 已超期且未完成 | `due_date < 今天` 且 `status !== 'done'` |

### 2. 交互逻辑

#### 点击行为
- 点击卡片时，自动设置对应的筛选条件
- 筛选栏同步更新显示当前筛选状态
- 列表根据筛选条件实时更新

#### 切换逻辑
- 点击不同卡片：切换到新的筛选条件
- 点击同一卡片（已激活）：取消筛选，显示全部
- 点击"总任务"：重置所有筛选条件

#### 视觉反馈
- 当前激活的卡片有视觉区分（边框高亮、背景色变化等）
- 其他卡片保持默认样式

## 技术实现方案

### 状态管理
```typescript
// 当前激活的统计卡片类型
type ActiveStatCard = 
  | 'all'           // 总任务
  | 'my_primary'    // 我负责的
  | 'my_participate'// 我参与的
  | 'done'          // 已完成
  | 'due_this_week' // 截止本周
  | 'due_this_month'// 截止本月
  | 'overdue'       // 超期未完成
  | null;           // 无激活

const [activeStatCard, setActiveStatCard] = useState<ActiveStatCard>(null);
```

### 筛选处理函数
```typescript
const handleStatCardClick = (cardType: ActiveStatCard) => {
  // 如果点击已激活的卡片，则取消筛选
  if (activeStatCard === cardType) {
    setActiveStatCard(null);
    setFilters({
      keyword: '',
      projectId: '',
      dateRange: { type: 'created', start: '', end: '' },
      statuses: [],
      priorities: []
    });
    return;
  }

  // 设置新的激活卡片
  setActiveStatCard(cardType);

  // 根据卡片类型设置筛选条件
  switch (cardType) {
    case 'all':
      // 重置所有筛选
      setFilters({
        keyword: '',
        projectId: '',
        dateRange: { type: 'created', start: '', end: '' },
        statuses: [],
        priorities: []
      });
      break;
    case 'done':
      setFilters(prev => ({
        ...prev,
        statuses: ['done']
      }));
      break;
    // ... 其他卡片类型
  }
};
```

### 卡片样式
```typescript
// 获取卡片样式
const getStatCardClass = (cardType: ActiveStatCard): string => {
  const baseClass = 'stat-card card-hover hover:-translate-y-0.5 hover:shadow-lg transition-all duration-200 ease-out cursor-pointer';
  const activeClass = 'ring-2 ring-primary-500 ring-offset-2 bg-primary-50/30';
  
  return activeStatCard === cardType 
    ? `${baseClass} ${activeClass}` 
    : baseClass;
};
```

## 相关文件
- `src/pages/tasks/TaskList.tsx` - 任务列表主页面

## 验收标准
- [ ] 点击"总任务"卡片重置所有筛选
- [ ] 点击"我负责的"筛选当前用户为主要负责人的任务
- [ ] 点击"我参与的"筛选当前用户为参与人（非主要）的任务
- [ ] 点击"已完成"筛选状态为 done 的任务
- [ ] 点击"截止本周"筛选本周内到期的未完成任务
- [ ] 点击"截止本月"筛选本月内到期的未完成任务
- [ ] 点击"超期未完成"筛选已超期但未完成的任务
- [ ] 点击已激活的卡片取消筛选
- [ ] 当前激活的卡片有视觉高亮效果
- [ ] 筛选栏同步更新显示当前筛选状态
