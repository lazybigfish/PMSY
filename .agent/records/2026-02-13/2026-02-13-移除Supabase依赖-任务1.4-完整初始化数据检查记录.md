# 移除 Supabase 依赖 - 任务 1.4 完整初始化数据检查记录

## 检查范围

对照原 Supabase migration 文件 (`20250209000000_init_schema.sql`)，检查所有 INSERT 语句。

## 检查结果

### 原 Supabase 中的初始化数据

| 表名 | 数据条数 | 说明 |
|------|----------|------|
| `ai_roles` | 1条 | 默认AI角色 |
| `milestone_templates` | 7条 | 7个里程碑阶段 |
| `milestone_tasks` | 26条 | 各阶段的任务 |
| **其他表** | 0条 | 无初始化数据 |

**总计：34条 INSERT 语句**

### 新 migrations 中的初始化数据

#### ✅ 已完整迁移的数据

1. **ai_roles 表** - 1条
   - 文件：`007_create_reports_and_ai.sql`
   - 数据：Senior Project Manager 角色
   - 状态：✅ 完整

2. **milestone_templates 表** - 7条
   - 文件：`003_create_milestones.sql`
   - 数据：进场前阶段、启动阶段、实施阶段、初验阶段、试运行阶段、终验阶段、运维阶段
   - 状态：✅ 完整

3. **milestone_tasks 表** - 26条
   - 文件：`003_create_milestones.sql`
   - 数据：每个阶段的详细任务
   - 状态：✅ 已补充完整

#### ⚠️ 需要特殊处理的数据

4. **profiles 表** - 1条（默认管理员）
   - 文件：`001_create_profiles.sql` + `seeds/001_seed_admin_user.ts`
   - 数据：admin@pmsy.com / admin123
   - 状态：⚠️ 使用 seed 脚本生成正确密码哈希
   - 说明：SQL 中的密码是占位符，真实密码通过 seed 脚本生成

### 不需要初始化数据的表

以下表在原 Supabase 中也没有初始化数据，都是空表：

- projects
- project_members
- project_modules
- project_milestones
- tasks
- task_assignees
- task_progress_updates
- task_comments
- suppliers
- supplier_payment_plans
- supplier_acceptance_records
- risks
- folders
- files
- file_operation_logs
- notifications
- storage_quotas
- reports
- report_templates
- ai_providers
- ai_analysis_results
- forum_posts
- forum_comments
- forum_likes
- hot_news

## 补充和修正

### 1. 里程碑任务数据补充
- **问题**：最初只插入了7个里程碑模板，没有插入26个任务
- **解决**：已在 `003_create_milestones.sql` 中补充完整的26个任务数据

### 2. 管理员密码处理
- **问题**：SQL 中无法直接生成 bcrypt 哈希
- **解决**：创建了 `seeds/001_seed_admin_user.ts` 脚本，使用 bcrypt 正确生成密码哈希

## 初始化数据汇总

| 类别 | 数量 | 状态 |
|------|------|------|
| AI 角色 | 1条 | ✅ 完整 |
| 里程碑模板 | 7条 | ✅ 完整 |
| 里程碑任务 | 26条 | ✅ 完整 |
| 默认管理员 | 1条 | ✅ 完整（通过 seed） |
| **总计** | **35条** | **✅ 全部完整** |

## 启动时初始化流程

1. Docker 启动 PostgreSQL
2. 自动执行 `database/migrations/` 中的 SQL 文件
3. 运行 `npm run db:seed` 执行 seed 脚本
4. 生成正确的管理员密码

## 结论

所有初始化数据已完整迁移，与原 Supabase 一致。
