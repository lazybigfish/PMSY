# 管理员账号配置记录 - 2026-02-13

## 配置概述
统一系统管理员账号为：
- **邮箱**: admin@pmsy.com
- **用户名**: admin
- **密码**: Willyou@2026

## 修改的文件

### 1. API 种子脚本
**文件**: `api-new/database/seeds/001_seed_admin_user.ts`

**修改内容**:
- 默认密码从 `admin123` 改为 `Willyou@2026`
- 添加密码更新逻辑：如果管理员已存在，更新密码为新密码
- 统一管理员 ID: `00000000-0000-0000-0000-000000000001`

**关键代码**:
```typescript
// 生成密码哈希 - 使用标准密码 Willyou@2026
const passwordHash = await bcrypt.hash('Willyou@2026', 10);

if (existingAdmin) {
  // 如果管理员已存在，更新密码为统一密码
  await knex('profiles')
    .where('id', '00000000-0000-0000-0000-000000000001')
    .update({
      password_hash: passwordHash,
      email: 'admin@pmsy.com',
      username: 'admin',
      updated_at: new Date(),
    });
  console.log('✅ 管理员用户密码已更新为: Willyou@2026');
  return;
}
```

### 2. 部署脚本
**文件**: `deploy/scripts/create-admin-user.sh`

**修改内容**:
- 默认密码从 `admin123` 改为 `Willyou@2026`
- 更新脚本注释

### 3. 数据库初始化 SQL
**文件**: `deploy/scripts/init-database.sql`

**修改内容**:
- 管理员 ID 从 `a0eebc99-9c0b-4ef8-bb6d-6bb9bd380a11` 改为 `00000000-0000-0000-0000-000000000001`
- 添加注释说明默认账号密码

## 数据库更新

### 执行命令
```bash
cd api-new
npm run db:seed
```

### 执行结果
```
✅ 管理员用户密码已更新为: Willyou@2026
Ran 2 seed files
```

## 登录验证

### 测试命令
```bash
curl -s -X POST "http://localhost:3001/auth/v1/token?grant_type=password" \
  -H "Content-Type: application/json" \
  -d '{"email":"admin@pmsy.com","password":"Willyou@2026"}'
```

### 验证结果
✅ 登录成功，返回 JWT Token

**返回数据**:
```json
{
  "access_token": "eyJhbGciOiJIUzI1NiIs...",
  "token_type": "bearer",
  "expires_in": 604800,
  "user": {
    "id": "00000000-0000-0000-0000-000000000001",
    "email": "admin@pmsy.com",
    "user_metadata": {
      "full_name": "系统管理员",
      "role": "admin"
    }
  }
}
```

## 当前数据库状态

### 管理员账号信息
```sql
SELECT id, email, username, role, full_name FROM profiles WHERE role = 'admin';
```

**结果**:
| id | email | username | role | full_name |
|----|-------|----------|------|-----------|
| 00000000-0000-0000-0000-000000000001 | admin@pmsy.com | admin | admin | 系统管理员 |

## 使用说明

### 开发环境登录
1. 访问 http://localhost:5174/login
2. 输入邮箱: admin@pmsy.com
3. 输入密码: Willyou@2026
4. 登录成功后即可访问系统管理员功能

### 生产环境部署
部署后执行以下命令创建管理员：
```bash
cd /opt/pmsy
./scripts/create-admin-user.sh
```

按提示使用默认设置即可。

## 安全建议

1. **首次登录后修改密码** - 建议登录后立即修改默认密码
2. **生产环境使用强密码** - 部署时可以考虑使用随机生成的强密码
3. **定期更换密码** - 建议每 3-6 个月更换一次管理员密码

## 记录时间
2026-02-13
