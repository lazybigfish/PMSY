# 弹窗使用规范

## 一、概述

本文档定义了项目中弹窗组件的使用规范，确保所有弹窗的视觉效果和交互行为保持一致。

**生效日期**: 2026-02-15  
**适用范围**: 全项目所有弹窗

---

## 二、强制规范

### 2.1 必须使用统一组件

所有弹窗必须使用 `src/components/Modal.tsx` 提供的组件，**禁止**在任何页面独立编写遮罩层代码。

| 规范项 | 要求 |
|-------|------|
| **统一组件** | 所有弹窗必须使用 `Modal`、`ModalForm` 或 `ConfirmModal` |
| **禁止独立实现** | 不允许在任何页面独立编写遮罩层代码 |
| **样式一致性** | 所有弹窗背景效果必须完全一致 |
| **交互一致性** | 所有弹窗必须支持点击背景关闭 |

### 2.2 禁止的写法

```tsx
// ❌ 错误做法 - 禁止！
<div className="fixed inset-0 bg-black/50">
  <div className="modal-content">...</div>
</div>

// ❌ 错误做法 - 禁止！
<div className="fixed inset-0 bg-black bg-opacity-50">
  <div className="modal-content">...</div>
</div>

// ❌ 错误做法 - 禁止！
{isOpen && (
  <div className="fixed inset-0 z-[100] flex items-center justify-center bg-black/50">
    <div>...</div>
  </div>
)}
```

### 2.3 推荐的写法

```tsx
// ✅ 正确做法 - 基础弹窗
import { Modal } from '@/components/Modal';

<Modal 
  isOpen={isOpen} 
  onClose={handleClose} 
  title="弹窗标题"
  maxWidth="md"
>
  弹窗内容
</Modal>

// ✅ 正确做法 - 表单弹窗
import { ModalForm } from '@/components/Modal';

<ModalForm 
  isOpen={isOpen} 
  onClose={handleClose}
  onSubmit={handleSubmit}
  title="表单标题"
  maxWidth="lg"
  isSubmitting={isSubmitting}
>
  表单内容
</ModalForm>

// ✅ 正确做法 - 确认弹窗
import { ConfirmModal } from '@/components/Modal';

<ConfirmModal
  isOpen={isOpen}
  onClose={handleClose}
  onConfirm={handleConfirm}
  title="确认操作"
  message="确定要执行此操作吗？"
  type="warning"
/>
```

---

## 三、组件 API

### 3.1 Modal 组件

**Props**:

| 属性 | 类型 | 必填 | 默认值 | 说明 |
|-----|------|------|-------|------|
| `isOpen` | boolean | 是 | - | 是否显示弹窗 |
| `onClose` | () => void | 是 | - | 关闭回调 |
| `title` | string | 否 | - | 弹窗标题 |
| `children` | ReactNode | 是 | - | 弹窗内容 |
| `maxWidth` | 'sm' \| 'md' \| 'lg' \| 'xl' \| '2xl' \| '3xl' \| '4xl' \| '5xl' | 否 | 'lg' | 最大宽度 |
| `showCloseButton` | boolean | 否 | true | 是否显示关闭按钮 |
| `className` | string | 否 | '' | 自定义类名 |

**示例**:

```tsx
<Modal
  isOpen={showModal}
  onClose={() => setShowModal(false)}
  title="详情"
  maxWidth="2xl"
>
  <div>内容...</div>
</Modal>
```

### 3.2 ModalForm 组件

**Props**:

| 属性 | 类型 | 必填 | 默认值 | 说明 |
|-----|------|------|-------|------|
| `isOpen` | boolean | 是 | - | 是否显示弹窗 |
| `onClose` | () => void | 是 | - | 关闭回调 |
| `onSubmit` | (e: FormEvent) => void | 是 | - | 提交回调 |
| `title` | string | 否 | - | 弹窗标题 |
| `children` | ReactNode | 是 | - | 表单内容 |
| `maxWidth` | string | 否 | 'lg' | 最大宽度 |
| `isSubmitting` | boolean | 否 | false | 是否提交中 |
| `submitDisabled` | boolean | 否 | false | 是否禁用提交 |
| `submitText` | string | 否 | '确认' | 提交按钮文字 |
| `cancelText` | string | 否 | '取消' | 取消按钮文字 |

**示例**:

```tsx
<ModalForm
  isOpen={showForm}
  onClose={() => setShowForm(false)}
  onSubmit={handleSubmit}
  title="新增项目"
  maxWidth="md"
  isSubmitting={saving}
>
  <input ... />
  <textarea ... />
</ModalForm>
```

### 3.3 ConfirmModal 组件

**Props**:

| 属性 | 类型 | 必填 | 默认值 | 说明 |
|-----|------|------|-------|------|
| `isOpen` | boolean | 是 | - | 是否显示弹窗 |
| `onClose` | () => void | 是 | - | 关闭回调 |
| `onConfirm` | () => void | 是 | - | 确认回调 |
| `title` | string | 否 | '确认操作' | 弹窗标题 |
| `message` | string | 是 | - | 确认消息 |
| `confirmText` | string | 否 | '确认' | 确认按钮文字 |
| `cancelText` | string | 否 | '取消' | 取消按钮文字 |
| `isLoading` | boolean | 否 | false | 是否加载中 |
| `type` | 'danger' \| 'warning' \| 'info' | 否 | 'warning' | 确认类型 |

**示例**:

```tsx
<ConfirmModal
  isOpen={showConfirm}
  onClose={() => setShowConfirm(false)}
  onConfirm={handleDelete}
  title="删除确认"
  message="确定要删除此项目吗？此操作不可恢复。"
  type="danger"
/>
```

---

## 四、视觉效果规范

### 4.1 背景效果

所有弹窗使用统一的径向渐变毛玻璃效果：

- **中心暗度**: `rgba(0,0,0,0.5)`
- **15%半径**: `rgba(0,0,0,0.35)`
- **30%半径**: `rgba(0,0,0,0.2)`
- **50%半径**: `rgba(0,0,0,0.05)`
- **70%半径**: `transparent`
- **模糊半径**: `8px`

### 4.2 交互效果

- **打开动画**: 淡入 300ms
- **关闭动画**: 淡出 200ms
- **点击背景**: 关闭弹窗
- **点击内容区**: 不关闭（阻止冒泡）

---

## 五、Code Review 检查清单

在 Code Review 时，请检查以下项目：

- [ ] 弹窗是否使用 `Modal`、`ModalForm` 或 `ConfirmModal` 组件
- [ ] 是否存在独立实现的 `fixed inset-0 bg-black` 遮罩代码
- [ ] 弹窗是否正确处理 `onClose` 回调
- [ ] 表单弹窗是否正确处理 `onSubmit` 回调
- [ ] 弹窗内容是否正确阻止事件冒泡

---

## 六、常见问题

### Q1: 为什么必须使用统一组件？

**A**: 统一组件确保：
1. 视觉和交互一致性
2. 降低维护成本
3. 避免重复代码
4. 便于后续统一调整

### Q2: 如何自定义弹窗样式？

**A**: 可以通过 `className` 属性传入自定义类名，但禁止覆盖背景遮罩样式。

### Q3: 如何处理复杂的弹窗内容？

**A**: 复杂的弹窗内容可以提取为独立组件，但仍需使用 `Modal` 组件包裹。

```tsx
// 推荐做法
<Modal isOpen={isOpen} onClose={handleClose} title="复杂弹窗">
  <ComplexContent />
</Modal>
```

---

## 七、参考文档

- [实现记录](.agent/records/2026-02-15/弹窗背景渐变毛玻璃效果实现记录.md)
- [需求文档](.agent/records/2026-02-15/弹窗背景渐变毛玻璃效果需求.md)
- [组件源码](../../src/components/Modal.tsx)

---

**最后更新**: 2026-02-15
