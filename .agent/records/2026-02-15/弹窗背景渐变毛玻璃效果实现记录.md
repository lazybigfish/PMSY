# 弹窗背景渐变毛玻璃效果实现记录

## 一、实施概述

**实施时间**: 2026-02-15  
**实施内容**: 弹窗背景渐变毛玻璃效果 + 全局统一规范  
**状态**: ✅ 全部完成

---

## 二、已完成工作

### 2.1 核心组件更新

**文件**: `src/components/Modal.tsx`

**更新内容**:
- 背景遮罩从 `bg-black/50 backdrop-blur-sm` 改为径向渐变毛玻璃效果
- 使用 CSS `radial-gradient` 实现从中心向外淡化的效果
- 参数配置：
  - 中心暗度: `rgba(0,0,0,0.5)`
  - 15%半径: `rgba(0,0,0,0.35)`
  - 30%半径: `rgba(0,0,0,0.2)`
  - 50%半径: `rgba(0,0,0,0.05)`
  - 70%半径: `transparent`
  - 模糊半径: `8px`

**影响的组件**:
1. `Modal` - 基础弹窗
2. `ModalForm` - 表单弹窗
3. `ConfirmModal` - 确认弹窗

### 2.2 独立弹窗重构

#### SupplierDetailModal.tsx
**文件**: `src/pages/projects/components/SupplierDetailModal.tsx`

**整改内容**:
- 主弹窗改用 `Modal` 组件
- 内嵌弹窗 `AddAcceptanceModal` 改用 `Modal` 组件
- 内嵌弹窗 `AddPaymentPlanModal` 改用 `Modal` 组件
- 内嵌弹窗 `ConfirmPaymentModal` 改用 `Modal` 组件
- 移除独立实现的背景遮罩代码

#### ResetPasswordModal.tsx
**文件**: `src/pages/system/tabs/UserManagement/components/ResetPasswordModal.tsx`

**整改内容**:
- 改用 `Modal` 组件
- 移除独立实现的背景遮罩代码

#### TaskProgressUpdateModal.tsx
**文件**: `src/pages/tasks/components/TaskProgressUpdateModal.tsx`

**整改内容**:
- 改用 `Modal` 组件
- 移除独立实现的背景遮罩代码 `bg-black/50 backdrop-blur-sm`

#### Milestones.tsx
**文件**: `src/pages/projects/tabs/Milestones.tsx`

**整改内容**:
- 新增阶段弹窗改用 `ModalForm` 组件
- 新增任务弹窗改用 `ModalForm` 组件
- 移除独立实现的背景遮罩代码 `bg-black bg-opacity-50`

#### Risks.tsx
**文件**: `src/pages/projects/tabs/Risks.tsx`

**整改内容**:
- 风险详情弹窗改用 `Modal` 组件
- 移除独立实现的背景遮罩代码 `bg-black bg-opacity-50`

#### Suppliers.tsx
**文件**: `src/pages/projects/tabs/Suppliers.tsx`

**整改内容**:
- 关联供应商弹窗改用 `ModalForm` 组件
- 移除独立实现的背景遮罩代码 `bg-black bg-opacity-50`

#### TaskDetail.tsx
**文件**: `src/pages/tasks/components/TaskDetail.tsx`

**整改内容**:
- Radix UI Dialog 遮罩改为径向渐变毛玻璃效果
- 更新 `DialogPrimitive.Overlay` 样式

#### HotNewsTab.tsx
**文件**: `src/pages/water/HotNewsTab.tsx`

**整改内容**:
- 详情弹窗改用 `Modal` 组件
- 移除独立实现的背景遮罩代码 `bg-black bg-opacity-50`

#### UserManagement/index.tsx
**文件**: `src/pages/system/tabs/UserManagement/index.tsx`

**整改内容**:
- 新增/编辑用户弹窗改用 `ModalForm` 组件
- 移除独立实现的背景遮罩代码 `bg-black bg-opacity-50`

#### ReportTemplates.tsx
**文件**: `src/pages/system/tabs/ReportTemplates.tsx`

**整改内容**:
- 新增/编辑模板弹窗改用 `ModalForm` 组件
- 移除独立实现的背景遮罩代码 `bg-black bg-opacity-50`

#### FileManager.tsx
**文件**: `src/pages/files/FileManager.tsx`

**整改内容**:
- 上传进度弹窗改用 `Modal` 组件
- 移除独立实现的背景遮罩代码 `bg-black bg-opacity-50`

#### RoleManagement.tsx
**文件**: `src/pages/system/tabs/RoleManagement.tsx`

**整改内容**:
- 新增/编辑角色弹窗改用 `ModalForm` 组件
- 移除独立实现的背景遮罩代码 `bg-black bg-opacity-50`

#### Profile.tsx
**文件**: `src/pages/Profile.tsx`

**整改内容**:
- 修改密码弹窗改用 `ModalForm` 组件
- 移除独立实现的背景遮罩代码 `bg-black bg-opacity-50`

#### FileUploadButton.tsx
**文件**: `src/components/FileUploadButton.tsx`

**整改内容**:
- 上传进度弹窗改用 `Modal` 组件
- 移除独立实现的背景遮罩代码 `bg-black bg-opacity-50`

---

## 三、整改统计

| 类型 | 数量 | 已完成 | 待整改 |
|-----|------|-------|-------|
| 核心组件 | 1 | 1 | 0 |
| 独立弹窗组件 | 4 | 4 | 0 |
| 页面内联弹窗 | 11 | 11 | 0 |
| **总计** | **16** | **16** | **0** |

---

## 四、技术实现细节

### 4.1 径向渐变效果实现

```tsx
<div
  className="fixed inset-0 z-[100] flex items-center justify-center p-4 animate-fade-in"
  style={{
    background: `radial-gradient(circle at center,
      rgba(0,0,0,0.5) 0%,
      rgba(0,0,0,0.35) 15%,
      rgba(0,0,0,0.2) 30%,
      rgba(0,0,0,0.05) 50%,
      transparent 70%
    )`,
    backdropFilter: 'blur(8px)',
    WebkitBackdropFilter: 'blur(8px)',
  }}
  onClick={onClose}
>
```

### 4.2 点击背景关闭实现

```tsx
<div onClick={onClose}>
  <div onClick={(e) => e.stopPropagation()}>
    {/* 弹窗内容 */}
  </div>
</div>
```

### 4.3 组件使用规范

```tsx
// ✅ 正确做法
import { Modal, ModalForm, ConfirmModal } from '@/components/Modal';

<Modal isOpen={isOpen} onClose={handleClose} title="标题">
  内容
</Modal>

// ❌ 错误做法
<div className="fixed inset-0 bg-black/50">...</div>
```

---

## 五、验收结果

### 5.1 已验证项目

- [x] Modal 组件径向渐变毛玻璃效果正常显示
- [x] 点击背景遮罩可关闭弹窗
- [x] 点击弹窗内容不关闭弹窗
- [x] SupplierDetailModal 使用统一组件
- [x] ResetPasswordModal 使用统一组件
- [x] TaskProgressUpdateModal 使用统一组件
- [x] Milestones.tsx 弹窗使用统一组件
- [x] Risks.tsx 弹窗使用统一组件
- [x] Suppliers.tsx 弹窗使用统一组件
- [x] TaskDetail.tsx 遮罩效果更新
- [x] HotNewsTab.tsx 弹窗使用统一组件
- [x] UserManagement/index.tsx 弹窗使用统一组件
- [x] ReportTemplates.tsx 弹窗使用统一组件
- [x] FileManager.tsx 弹窗使用统一组件
- [x] RoleManagement.tsx 弹窗使用统一组件
- [x] Profile.tsx 弹窗使用统一组件
- [x] FileUploadButton.tsx 弹窗使用统一组件

### 5.2 待验证项目

- [ ] 各主流浏览器兼容性
- [ ] 移动端显示效果

---

## 六、后续建议

1. **Code Review**: 新增弹窗时必须使用统一组件，Code Review 时需重点检查
2. **文档更新**: 在开发文档中补充弹窗使用规范
3. **测试覆盖**: 建议增加弹窗组件的自动化测试

---

## 七、参考文档

- 需求文档: `.agent/records/2026-02-15/弹窗背景渐变毛玻璃效果需求.md`
- 统一组件: `src/components/Modal.tsx`
