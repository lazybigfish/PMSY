# 弹窗背景渐变毛玻璃效果需求

## 一、需求概述

**需求名称**: 弹窗背景渐变毛玻璃效果 + 全局统一规范  
**提出时间**: 2026-02-15  
**需求类型**: UI 视觉优化 + 代码规范  
**状态**: 待审查

---

## 二、核心需求描述

### 2.1 当前问题
1. 现有弹窗背景采用**全屏均匀毛玻璃效果**，视觉层次单一
2. 部分弹窗**独立实现背景遮罩**，样式不统一
3. 部分弹窗**缺少点击背景退出**的交互

### 2.2 目标效果
1. **径向渐变毛玻璃**: 以弹窗为中心，毛玻璃效果向外逐渐淡化直至透明
2. **点击背景退出**: 点击遮罩区域关闭弹窗
3. **全局统一**: 所有弹窗必须使用统一组件，禁止独立实现遮罩

---

## 三、设计方案

### 3.1 视觉设计

**径向渐变效果示意**:
```
        透明区域
            ↓
    ┌─────────────────┐
    │   淡化过渡区    │
    │   ┌─────────┐   │
    │   │ 弹窗中心 │   │  ← 最强毛玻璃
    │   │ ███████ │   │
    │   │ ███████ │   │
    │   └─────────┘   │
    │   淡化过渡区    │
    └─────────────────┘
        透明区域
```

**技术参数**:

| 参数 | 建议值 |
|-----|-------|
| 中心暗度 | `rgba(0,0,0,0.5)` ~ `rgba(0,0,0,0.6)` |
| 模糊半径 | `8px` ~ `12px` |
| 淡化起始点 | 弹窗外边缘 + 50px |
| 完全透明点 | 距离中心 60-70% 视口 |

### 3.2 交互设计

| 交互 | 行为 |
|-----|------|
| 点击背景遮罩 | 关闭弹窗 |
| 点击弹窗内容区 | 不关闭（阻止冒泡） |
| ESC 键 | 关闭弹窗（可选增强） |
| 打开动画 | 径向渐变从中心向外扩散 300ms |
| 关闭动画 | 弹窗淡出 + 遮罩淡出 200ms |

---

## 四、全局统一规范（重要）

### 4.1 强制规范

| 规范项 | 要求 |
|-------|------|
| **统一组件** | 所有弹窗必须使用 `src/components/Modal.tsx` 提供的组件 |
| **禁止独立实现** | 不允许在任何页面独立编写遮罩层代码 |
| **样式一致性** | 所有弹窗背景效果必须完全一致 |
| **交互一致性** | 所有弹窗必须支持点击背景关闭 |

### 4.2 组件使用指南

```tsx
// ✅ 正确做法：使用统一组件
import { Modal, ModalForm, ConfirmModal } from '@/components/Modal';

// 基础弹窗
<Modal isOpen={isOpen} onClose={handleClose} title="标题">
  内容
</Modal>

// 表单弹窗
<ModalForm 
  isOpen={isOpen} 
  onClose={handleClose} 
  onSubmit={handleSubmit}
  title="表单标题"
>
  表单内容
</ModalForm>

// 确认弹窗
<ConfirmModal
  isOpen={isOpen}
  onClose={handleClose}
  onConfirm={handleConfirm}
  title="确认操作"
  content="确定要执行此操作吗？"
/>
```

```tsx
// ❌ 错误做法：独立实现遮罩
<div className="fixed inset-0 bg-black/50">  // 禁止！
  <div className="modal-content">...</div>
</div>
```

### 4.3 需要整改的文件清单

根据前期调研，以下文件需要统一整改：

| 文件路径 | 当前问题 | 整改方式 |
|---------|---------|---------|
| `src/pages/projects/components/SupplierDetailModal.tsx` | 独立实现，无模糊效果 | 使用统一 Modal 组件重构 |
| `src/pages/system/tabs/UserManagement/components/ResetPasswordModal.tsx` | 独立实现，无模糊效果 | 使用统一 Modal 组件重构 |
| `src/pages/stakeholders/ClientList.tsx` | 内联弹窗实现 | 提取为独立组件或使用 Modal |
| `src/pages/suppliers/SupplierList.tsx` | 内联弹窗实现 | 提取为独立组件或使用 Modal |
| `src/pages/projects/tabs/Milestones.tsx` | 内联弹窗实现 | 提取为独立组件或使用 Modal |
| `src/pages/projects/tabs/Risks.tsx` | 内联弹窗实现 | 提取为独立组件或使用 Modal |
| `src/pages/water/HotNewsTab.tsx` | 内联弹窗实现 | 提取为独立组件或使用 Modal |
| `src/pages/system/tabs/UserManagement/index.tsx` | 内联弹窗实现 | 提取为独立组件或使用 Modal |
| `src/pages/system/tabs/ReportTemplates.tsx` | 内联弹窗实现 | 提取为独立组件或使用 Modal |
| `src/pages/files/FileManager.tsx` | 内联弹窗实现 | 提取为独立组件或使用 Modal |
| `src/pages/system/tabs/RoleManagement.tsx` | 内联弹窗实现 | 提取为独立组件或使用 Modal |
| `src/pages/Profile.tsx` | 内联弹窗实现 | 提取为独立组件或使用 Modal |
| `src/components/FileUploadButton.tsx` | 内联弹窗实现 | 提取为独立组件或使用 Modal |

---

## 五、技术实现方案

### 5.1 Modal 组件更新计划

**文件**: `src/components/Modal.tsx`

**更新内容**:
1. 背景遮罩改为径向渐变毛玻璃效果
2. 确保点击遮罩关闭弹窗
3. 弹窗内容阻止点击冒泡
4. 添加打开/关闭动画

```tsx
// 核心实现示意
<div 
  className="fixed inset-0 z-[100] flex items-center justify-center p-4 animate-fade-in"
  style={{
    background: `radial-gradient(circle at center, 
      rgba(0,0,0,0.5) 0%, 
      rgba(0,0,0,0.3) 15%, 
      rgba(0,0,0,0.1) 30%, 
      transparent 60%
    )`,
    backdropFilter: 'blur(8px)',
    WebkitBackdropFilter: 'blur(8px)',
  }}
  onClick={onClose}  // 点击背景关闭
>
  <div 
    className="bg-white rounded-2xl shadow-2xl animate-scale-in"
    onClick={e => e.stopPropagation()}  // 阻止冒泡
  >
    {children}
  </div>
</div>
```

### 5.2 实施步骤

| 步骤 | 任务 | 优先级 |
|-----|------|-------|
| 1 | 更新 `Modal.tsx` 组件，实现径向渐变毛玻璃效果 | P0 |
| 2 | 验证 Modal、ModalForm、ConfirmModal 三个组件 | P0 |
| 3 | 逐步替换各页面独立弹窗实现 | P1 |
| 4 | 全站弹窗效果统一检查 | P2 |

---

## 六、验收标准

- [ ] 弹窗背景呈现径向渐变毛玻璃效果，从中心向外淡化至透明
- [ ] 点击背景遮罩区域可关闭弹窗
- [ ] 点击弹窗内容区域不关闭弹窗
- [ ] 所有弹窗使用统一组件，无独立实现
- [ ] 动画流畅，无卡顿
- [ ] 各主流浏览器正常显示

---

## 七、补充说明

1. **为什么必须统一**: 统一组件确保视觉和交互一致性，降低维护成本，避免重复代码
2. **整改范围**: 所有内联弹窗实现都需要提取到独立组件或使用统一 Modal
3. **后续规范**: 新增弹窗必须遵循此规范，Code Review 时需重点检查
