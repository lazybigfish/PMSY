# 里程碑任务恢复正确数据记录

## 问题描述

之前修复里程碑任务时，由于不了解用户已设计好的里程碑模板数据，创建了虚构的默认任务（任务规划、执行与监控、阶段评审）。用户指出应该使用系统预设的里程碑版本内容。

## 用户预设的里程碑模板

系统已设计好完整的 7 个阶段及其任务：

### 阶段 1: 进场前阶段（5个任务）
1. 获取基础材料 - 收集项目可研文件、项目合同
2. 明确干系人 - 梳理甲方负责人及联系人，输出《项目干系人清单》
3. 组建项目团队 - 根据建设方向（自研/外采）明确团队成员，输出《项目团队成员表》
4. 风险与预算分析 - 基于可研和合同，输出《项目风险清单》和《项目预算规划表》
5. 召开内部启动会 - 整合前期材料，形成会议纪要

### 阶段 2: 启动阶段（6个任务）
1. 编制基础文档 - 输出《项目经理授权函》《开工报审表》
2. 拆解建设内容 - 形成《项目实施功能清单》和《项目实施方案》
3. 制定进度计划 - 输出《项目实施计划表》
4. 召开项目启动会 - 明确议程、参会人，最终输出《开工令》和《会议纪要》
5. 筹备服务器资源 - 申请并确认资源，输出《服务器资源清单》
6. 供应商/硬件下单 - 根据功能清单签订合同（可选）

### 阶段 3: 实施阶段（5个任务）
1. 需求调研 - 输出全套设计文档（需求规格、数据库设计、概要/详细设计说明书）
2. 系统部署 - 在已申请服务器上部署系统，更新《服务器资源清单》
3. 第三方测评 - 开展软件测试、三级等保测评、商用密码测评
4. 培训与自查 - 组织用户培训并记录；项目组进行功能点自查
5. 监理核查 - 由监理方对功能进行核验

### 阶段 4: 初验阶段（4个任务）
1. 整理验收文档 - 编制完整的《文档目录》
2. 筹备并召开初验会 - 提交初验申请，形成《初步验收报告》
3. 整改专家意见 - 针对问题输出《遗留问题整改报告》
4. 上线试运行 - 提交《试运行申请》，系统进入试运行期

### 阶段 5: 试运行阶段（2个任务）
1. 试运行保障 - 持续监控并记录运行情况
2. 项目结算与决算 - 依次输出《结算报告》和《决算报告》

### 阶段 6: 终验阶段（3个任务）
1. 试运行总结 - 输出《试运行总结报告》
2. 终验筹备与召开 - 提交终验申请，形成《终验报告》
3. 终验整改 - 再次整改专家意见，更新《遗留问题整改报告》

### 阶段 7: 运维阶段（1个任务）
1. 项目移交 - 整理全部过程材料，输出《移交清单》，正式移交运维

## 修复操作

### 1. 删除虚构任务
删除了之前创建的 105 个虚构任务（任务规划、执行与监控、阶段评审）

### 2. 恢复正确任务
根据 `milestone_task_templates` 表中的模板数据，为所有项目里程碑创建正确的任务：
- 共 6 个项目
- 每个项目 7 个阶段
- 共 26 个任务模板（各阶段任务数不同）
- 总计创建 135 个里程碑任务

### 3. 修复脚本
创建了修复脚本 `scripts/restore-milestone-tasks.ts`，执行以下操作：
1. 删除虚构任务
2. 遍历所有项目
3. 为每个项目的每个里程碑根据模板创建正确任务

## 修复结果

- 里程碑页面现在正确显示用户设计的任务
- 每个阶段显示正确的任务数量和详细描述
- 任务输出物文档要求正确配置
- 控制台无报错

## 相关文件

- `api-new/scripts/restore-milestone-tasks.ts` - 修复脚本
- `api-new/database/migrations/010_create_milestone_templates.sql` - 里程碑模板定义
- `src/pages/projects/tabs/Milestones.tsx` - 前端页面

## 模板数据来源

- `milestone_templates` 表 - 7 个阶段定义
- `milestone_task_templates` 表 - 26 个任务定义

## 修复时间

2026-02-15

## 经验教训

1. 在执行数据修复前，应该先查看现有的模板/种子数据
2. 不要假设默认数据，应该基于实际业务数据操作
3. 修复脚本应该支持幂等执行，可以重复运行
