# 供应商关联插入报错修复

## 问题描述

项目详情的供应商页面，点击关联供应商后报错：

```
添加失败: insert into "project_suppliers" ("contract_amount", "contract_file_url", "created_by", "module_ids", "project_id", "supplier_id") values ($1, $2, $3, $4, $5, $6) returning * - column "contract_file_url" of relation "project_suppliers" does not exist
```

## 问题原因

前端代码在插入 `project_suppliers` 表时，包含了数据库中不存在的字段：
- `contract_file_url`
- `module_ids`

而数据库表 `project_suppliers` 的实际字段为：
- `id`, `project_id`, `supplier_id`, `contract_amount`, `contract_date`, `delivery_date`, `status`, `notes`, `created_at`, `updated_at`

## 修复内容

### 修改文件

`src/pages/projects/tabs/Suppliers.tsx`

### 修改前

```typescript
const { error } = await api.db.from('project_suppliers').insert({
  project_id: projectId,
  supplier_id: selectedSupplierId,
  contract_amount: addForm.contract_amount,
  contract_file_url: addForm.contract_file_url,
  module_ids: selectedModuleIds
});
```

### 修改后

```typescript
const { error } = await api.db.from('project_suppliers').insert({
  project_id: projectId,
  supplier_id: selectedSupplierId,
  contract_amount: addForm.contract_amount
});
```

## 修复逻辑

移除了数据库中不存在的字段 `contract_file_url` 和 `module_ids`，只保留表中实际存在的字段。

## 后续建议

如果业务需要存储合同文件URL和关联模块ID，需要：
1. 修改数据库迁移文件，添加相应字段
2. 或者创建关联表来存储这些信息

## 测试验证

1. 进入项目详情页的供应商页面
2. 点击"关联供应商"按钮
3. 选择供应商并填写合同金额
4. 点击确认，应成功添加供应商关联

## 修复时间

2026-02-16
