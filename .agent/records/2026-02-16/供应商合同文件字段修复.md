# 供应商合同文件字段修复

## 问题描述

之前添加供应商时，还有 `contract_file_url` 字段缺失，导致相关功能无法正常使用。

## 问题原因

`project_suppliers` 表缺少 `contract_file_url` 字段，但前端代码尝试使用这个字段来保存供应商合同文件URL。

## 修复内容

### 1. 创建数据库迁移文件

**文件**: `api-new/database/migrations/022_add_project_supplier_contract_file.sql`

```sql
-- 为 project_suppliers 表添加 contract_file_url 字段
ALTER TABLE project_suppliers
ADD COLUMN IF NOT EXISTS contract_file_url TEXT;

-- 添加注释
COMMENT ON COLUMN project_suppliers.contract_file_url IS '供应商合同文件URL';
```

### 2. 执行迁移脚本

**文件**: `api-new/scripts/add-contract-file-url-column.ts`

```typescript
import { db } from '../src/config/database';

async function runMigration() {
  try {
    await db.raw(`
      ALTER TABLE project_suppliers
      ADD COLUMN IF NOT EXISTS contract_file_url TEXT;
    `);
    console.log('Migration completed successfully: contract_file_url column added to project_suppliers');
    process.exit(0);
  } catch (error) {
    console.error('Migration failed:', error);
    process.exit(1);
  }
}

runMigration();
```

**执行命令**:
```bash
cd api-new && npx ts-node scripts/add-contract-file-url-column.ts
```

**执行结果**:
```
Migration completed successfully: contract_file_url column added to project_suppliers
```

## 修复后的表结构

`project_suppliers` 表现在包含以下字段：
- `id`, `project_id`, `supplier_id`, `contract_amount`, `contract_date`, `delivery_date`
- `status`, `notes`, `module_ids`, `contract_file_url` (新增), `created_at`, `updated_at`

## 测试验证

1. 进入项目详情页的供应商页面
2. 关联供应商时可以上传合同文件
3. 合同文件URL应正确保存

## 修复时间

2026-02-16
