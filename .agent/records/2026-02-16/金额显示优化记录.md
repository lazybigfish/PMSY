# 金额显示优化记录

## 修改日期
2026-02-16

## 需求背景
系统内对于金额的识读比较累，需要针对合同金额、付款金额等涉及金额的数字，都在旁边增加一个中文金额的显示，辅助阅读。同时所有金额的输入框统一调整，去除鼠标滑动调整金额的效果。

## 修改内容

### 1. 工具函数抽取
**文件**: `src/lib/utils.ts`
- 新增 `numberToChinese()` 函数，用于将数字金额转换为中文大写
- 统一维护，避免多处重复代码

### 2. 项目创建页
**文件**: `src/pages/projects/ProjectCreate.tsx`
- 移除本地 `numberToChinese` 函数定义
- 改为从 `utils.ts` 导入

### 3. 项目概览页
**文件**: `src/pages/projects/tabs/ProjectOverview.tsx`
- 移除本地 `numberToChinese` 函数定义
- 改为从 `utils.ts` 导入
- 编辑模式下的项目金额输入框改为 `type="text"` + `inputMode="decimal"`，去除鼠标滑动效果
- 编辑时实时显示中文金额预览
- 采购金额、已支付金额显示区域添加中文金额

### 4. 供应商列表页
**文件**: `src/pages/projects/tabs/Suppliers.tsx`
- 导入 `numberToChinese` 函数
- 供应商列表中的合同金额、已支付金额列添加中文金额显示
- 添加供应商弹窗的合同金额输入框添加中文金额预览

### 5. 供应商详情弹窗
**文件**: `src/pages/projects/components/SupplierDetailModal.tsx`
- 移除本地 `numberToChinese` 函数定义
- 改为从 `utils.ts` 导入
- 基本信息标签页的统计卡片（合同金额、已支付金额、未支付金额）添加中文金额
- 合同金额编辑输入框改为 `type="text"`，去除鼠标滑动效果
- 非编辑状态下的合同金额显示添加中文金额
- 验收与付款标签页的统计卡片添加中文金额
- 付款计划表格中的金额列添加中文金额
- 新增付款计划弹窗的合同金额显示添加中文金额
- 付款比例输入框改为 `type="text"`，去除鼠标滑动效果
- 付款金额显示改为只读文本 + 中文金额
- 确认付款弹窗的计划付款金额添加中文金额

### 6. 项目列表页
**文件**: `src/pages/projects/ProjectList.tsx`
- 导入 `numberToChinese` 函数
- 项目列表中的金额列添加中文金额显示

## 效果示例

### 金额显示
```
¥123,456.78
（壹拾贰万叁仟肆佰伍拾陆元柒角捌分）
```

### 金额输入框
```
[ ¥ 123456.78          ]
大写：壹拾贰万叁仟肆佰伍拾陆元柒角捌分
```

## 技术要点

1. **统一工具函数**: 将 `numberToChinese` 抽取到 `utils.ts`，避免代码重复
2. **输入框统一**: 所有金额输入框使用 `type="text"` + `inputMode="decimal"`，既保证移动端数字键盘，又去除鼠标滚轮调整
3. **正则验证**: 输入时使用 `/^\d*\.?\d{0,2}$/` 正则限制只能输入数字和最多两位小数
4. **实时预览**: 输入时实时计算并显示中文金额

## 涉及文件清单
- `src/lib/utils.ts` (新增函数)
- `src/pages/projects/ProjectCreate.tsx`
- `src/pages/projects/tabs/ProjectOverview.tsx`
- `src/pages/projects/tabs/Suppliers.tsx`
- `src/pages/projects/components/SupplierDetailModal.tsx`
- `src/pages/projects/ProjectList.tsx`

## 验证状态
- [x] 代码编译通过
- [x] 服务启动正常
- [ ] 功能测试（需人工验证）
