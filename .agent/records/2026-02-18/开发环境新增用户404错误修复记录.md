# 开发环境新增用户 404 错误修复记录

## 问题描述

**时间**: 2026-02-18

**现象**: 在开发环境新增用户时，浏览器控制台报错：

```
POST http://localhost:5173/auth/v1/admin/users 404 (Not Found)
```

## 问题分析

### 1. 后端接口检查

后端 API 服务运行正常，`POST /auth/v1/admin/users` 接口可以正常响应：

```bash
curl -X POST http://localhost:3001/auth/v1/admin/users
# 返回: HTTP Status: 201, 用户创建成功
```

### 2. 前端代理配置检查

检查 `vite.config.ts` 的代理配置：

```typescript
server: {
  proxy: {
    '/api': { target: 'http://localhost:3001', ... },
    '/rest': { target: 'http://localhost:3001', ... }
  }
}
```

**发现问题**: 代理配置只包含了 `/api` 和 `/rest` 路径，但新增用户接口是 `/auth/v1/admin/users`，`/auth` 路径没有被代理。

### 3. 根本原因

前端请求 `POST /auth/v1/admin/users` 时，由于 vite 代理配置中没有 `/auth` 路径的规则，请求被直接发送到前端开发服务器 `http://localhost:5173/auth/v1/admin/users`，而不是后端 API 服务 `http://localhost:3001/auth/v1/admin/users`，因此返回 404。

## 修复方案

在 `vite.config.ts` 中添加 `/auth` 路径的代理配置：

```typescript
server: {
  proxy: {
    '/api': {
      target: 'http://localhost:3001',
      changeOrigin: true,
      secure: false,
      // ...
    },
    '/rest': {
      target: 'http://localhost:3001',
      changeOrigin: true,
      secure: false,
      // ...
    },
    '/auth': {
      target: 'http://localhost:3001',
      changeOrigin: true,
      secure: false,
      configure: (proxy) => {
        proxy.on('error', (err) => {
          console.log('proxy error', err);
        });
        proxy.on('proxyReq', (proxyReq, req) => {
          console.log('Sending Request to the Target:', req.method, req.url);
        });
        proxy.on('proxyRes', (proxyRes, req) => {
          console.log('Received Response from the Target:', proxyRes.statusCode, req.url);
        });
      },
    }
  }
}
```

## 修改文件

| 文件 | 修改内容 |
|-----|---------|
| `vite.config.ts` | 添加 `/auth` 路径代理配置 |

## 后续操作

1. **重启前端开发服务器** - 修改 vite 配置后需要重启前端服务才能生效
2. **验证修复** - 在浏览器中测试新增用户功能

## 经验总结

1. **代理配置完整性** - 在配置前端代理时，需要确保所有 API 路径都被正确代理
2. **路径规划** - 建议统一 API 路径前缀（如全部使用 `/api/*`），避免多个不同前缀需要分别配置代理
3. **404 错误排查** - 开发环境 404 错误通常有两种情况：
   - 后端接口不存在（需要后端修复）
   - 前端代理未配置（需要前端修复）
