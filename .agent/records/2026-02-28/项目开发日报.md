# 项目开发日报

## 日期
2026-02-28

## 工作内容

### 1. 项目列表金额显示优化

#### 需求背景
用户希望在项目列表的"项目金额"列中，合同金额和回款金额前面增加文字提示，使数据更清晰易懂。

#### 技术实现

1. **修改文件**
   - `src/pages/projects/ProjectList.tsx`

2. **实现内容**
   - 合同金额前添加"合同额"提示
   - 回款金额前添加"已回款"提示
   - 样式保持与金额数字一致：使用 `font-mono font-semibold`
   - 颜色使用灰色 `#9ca3af`，深色/浅色主题保持一致

3. **显示效果**
   - 合同额 2,567.00万
   - 已回款 2,438.65万

### 2. 功能模块层级上下移功能修复

#### 问题描述
功能模块的层级上下移功能无法正常使用。用户需要的是：
- **上移**：将模块提升到更高层级（比如二级模块变成一级）
- **下移**：将模块降级到更低层级（比如一级模块变成二级）

#### 技术实现

1. **修改文件**
   - `src/pages/projects/tabs/FunctionalModules.tsx`

2. **修复内容**

   **修复1：buildTree 函数添加排序逻辑**
   - 在构建树形结构时，按 sort_order 字段对每个层级的节点进行排序

   **修复2：handleMoveModule 函数重构为层级升降功能**

   **上移逻辑**：
   - 如果是顶级模块（无父节点）→ 无法上移
   - 如果是子模块且有前一个兄弟节点 → 成为该兄弟节点的子模块
   - 如果是子模块且无前一个兄弟节点 → 提升为父模块的兄弟节点

   **下移逻辑**：
   - 如果没有子模块 → 无法下移
   - 如果有子模块 → 将当前模块降级为其第一个子模块的子模块

3. **功能说明**
   - ArrowUp 按钮：将模块提升到更高层级
   - ArrowDown 按钮：将模块降级到更低层级

## 后续优化建议
1. 可考虑在其他金额显示位置添加类似的提示
2. 可添加金额类型的筛选功能
