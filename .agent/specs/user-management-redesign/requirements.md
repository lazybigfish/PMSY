# 用户管理模块重构需求文档

## 1. 背景

当前用户管理模块功能不完整，存在以下问题：
- 重置密码功能不可用（缺少后端接口）
- 编辑用户功能未实现
- 删除用户功能未实现
- 前端直接调用 fetch，缺少统一封装
- 缺少表单验证机制

## 2. 用户故事

### 2.1 作为管理员，我想要重置用户密码
- 点击重置密码按钮
- 系统生成随机强密码
- 显示新密码并提供复制功能
- 用户首次登录需强制修改密码

### 2.2 作为管理员，我想要编辑用户信息
- 点击编辑按钮打开编辑弹窗
- 可以修改：用户名、姓名、邮箱、角色、状态
- 保存后实时更新列表

### 2.3 作为管理员，我想要禁用/删除用户
- 点击删除按钮确认
- 系统执行软删除（标记为禁用）
- 被禁用用户无法登录
- 可以重新启用用户

### 2.4 作为管理员，我想要查看用户详情
- 点击用户行查看详情
- 显示：基本信息、登录记录、操作日志

## 3. 功能需求

### 3.1 用户列表
- 分页展示用户列表
- 支持按用户名、姓名、邮箱搜索
- 支持按角色筛选
- 支持按状态筛选

### 3.2 新增用户
- 表单字段：用户名（必填）、姓名、邮箱、密码（必填）、角色
- 表单验证：用户名唯一、邮箱格式、密码强度
- 创建成功后发送通知

### 3.3 编辑用户
- 可编辑字段：用户名、姓名、邮箱、角色、状态
- 用户名不可修改（作为登录凭证）
- 修改后记录操作日志

### 3.4 重置密码
- **两种重置模式可选**：
  1. **随机密码** - 系统生成12位随机强密码（大小写+数字+特殊字符）
  2. **固定密码** - 默认密码 `POP-101-ADA`
- 显示新密码并提供复制按钮
- **首次登录改密码策略**：
  - 默认仅提醒，不强制
  - 提供"强制改密"开关按钮，管理员可手动开启
  - 开启后，用户必须修改密码才能继续使用系统

### 3.5 禁用/启用用户
- 软删除机制（设置 is_active = false）
- 禁用用户无法登录
- 可以重新启用

## 4. 非功能需求

### 4.1 安全性
- 只有管理员可以操作用户
- 密码加密存储（bcrypt）
- 操作记录审计日志

### 4.2 性能
- 列表分页加载，每页 20 条
- 搜索防抖 300ms

### 4.3 用户体验
- 操作成功/失败 Toast 提示
- 表单错误实时反馈
- 危险操作二次确认

## 5. 验收标准

### 5.1 新增用户
```gherkin
Given 管理员已登录
When 填写用户信息并提交
Then 用户创建成功，列表自动刷新
And 新用户可以使用设置的密码登录
```

### 5.2 编辑用户
```gherkin
Given 管理员已登录且用户列表已加载
When 点击编辑按钮，修改信息并保存
Then 用户信息更新成功，列表显示最新信息
```

### 5.3 重置密码
```gherkin
Given 管理员已登录且用户列表已加载
When 点击重置密码按钮，选择重置模式（随机/固定）并确认
Then 系统根据选择的模式生成新密码并显示
And 默认仅提醒用户修改密码，不强制

Given 管理员已重置用户密码
When 点击"强制改密"开关按钮
Then 该用户下次登录时必须修改密码才能继续使用系统
```

### 5.4 禁用用户
```gherkin
Given 管理员已登录且用户列表已加载
When 点击删除按钮并确认
Then 用户被标记为禁用状态
And 该用户无法登录系统
```
