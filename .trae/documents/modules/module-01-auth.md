# æ¨¡å—01ï¼šè®¤è¯ä¸å…¬å…±æ¨¡å—éœ€æ±‚æ–‡æ¡£

## ç‰ˆæœ¬ä¿¡æ¯
- **ç‰ˆæœ¬**: 2.0
- **æ›´æ–°æ—¥æœŸ**: 2026-02-10
- **çŠ¶æ€**: å·²åŒæ­¥ä»£ç å®ç°

---

## ä¸€ã€æ¨¡å—æ¦‚è¿°

### 1.1 æ¨¡å—å®šä½
è®¤è¯ä¸å…¬å…±æ¨¡å—æ˜¯PMSYç³»ç»Ÿçš„å…¥å£æ¨¡å—ï¼Œè´Ÿè´£ç”¨æˆ·èº«ä»½è®¤è¯å’Œç³»ç»ŸåŸºç¡€åŠŸèƒ½ã€‚è¯¥æ¨¡å—ä¸ºå…¶ä»–æ‰€æœ‰æ¨¡å—æä¾›ç»Ÿä¸€çš„è®¤è¯æœåŠ¡å’Œå…¬å…±ç»„ä»¶æ”¯æŒã€‚

### 1.2 æ ¸å¿ƒèŒè´£
- ç”¨æˆ·èº«ä»½è®¤è¯ï¼ˆç™»å½•/ç™»å‡ºï¼‰
- å—ä¿æŠ¤è·¯ç”±æ§åˆ¶
- å…¨å±€å¸ƒå±€ç»„ä»¶
- ç”¨æˆ·ä¼šè¯ç®¡ç†

---

## äºŒã€ç”¨æˆ·è§’è‰²ä¸æƒé™

### 2.1 è§’è‰²å®šä¹‰

| è§’è‰² | è¯´æ˜ | æ•°æ®æ¥æº |
|------|------|----------|
| ç³»ç»Ÿç®¡ç†å‘˜ | æ‹¥æœ‰ç³»ç»Ÿå…¨éƒ¨ç®¡ç†æƒé™ | profiles.role = 'admin' |
| é¡¹ç›®ç”¨æˆ· | æ™®é€šé¡¹ç›®æˆå‘˜ | profiles.role = 'user' |

### 2.2 æƒé™çŸ©é˜µ

| åŠŸèƒ½ | ç³»ç»Ÿç®¡ç†å‘˜ | é¡¹ç›®ç”¨æˆ· |
|------|-----------|----------|
| ç™»å½•ç³»ç»Ÿ | âœ“ | âœ“ |
| è®¿é—®å·¥ä½œå° | âœ“ | âœ“ |
| æŸ¥çœ‹å¯¼èˆªèœå• | å…¨éƒ¨ | æ ¹æ®role_permissionsé…ç½® |
| ç³»ç»Ÿè®¾ç½® | âœ“ | âœ— |

---

## ä¸‰ã€åŠŸèƒ½éœ€æ±‚

### 3.1 ç™»å½•åŠŸèƒ½

#### 3.1.1 åŠŸèƒ½æè¿°
ç”¨æˆ·é€šè¿‡ç”¨æˆ·åå’Œå¯†ç ç™»å½•ç³»ç»Ÿã€‚

#### 3.1.2 ç™»å½•æµç¨‹
1. ç”¨æˆ·è¾“å…¥ç”¨æˆ·åå’Œå¯†ç 
2. ç³»ç»Ÿå°†ç”¨æˆ·åè½¬æ¢ä¸ºè™šæ‹Ÿé‚®ç®±æ ¼å¼ï¼š`username@pmsy.com`
3. è°ƒç”¨Supabase Authè¿›è¡Œèº«ä»½éªŒè¯
4. ç™»å½•æˆåŠŸåè·³è½¬åˆ°å·¥ä½œå°é¦–é¡µ
5. ç™»å½•å¤±è´¥æ˜¾ç¤ºé”™è¯¯æç¤º

#### 3.1.3 ç•Œé¢å…ƒç´ 

| å…ƒç´  | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| ç³»ç»Ÿæ ‡é¢˜ | æ–‡æœ¬ | "ç™»å½•ç³»ç»Ÿ" |
| æ³¨å†Œé“¾æ¥ | æŒ‰é’® | ç‚¹å‡»å¯æ³¨å†Œæ–°è´¦å· |
| ç”¨æˆ·åè¾“å…¥æ¡† | è¾“å…¥æ¡† | placeholder: "ç”¨æˆ·å (ä¾‹å¦‚: root)" |
| å¯†ç è¾“å…¥æ¡† | è¾“å…¥æ¡† | type="password" |
| ç™»å½•æŒ‰é’® | æŒ‰é’® | æ˜¾ç¤ºåŠ è½½çŠ¶æ€ |
| é”™è¯¯æç¤º | æ–‡æœ¬ | çº¢è‰²é”™è¯¯ä¿¡æ¯ |

#### 3.1.4 äº¤äº’é€»è¾‘
- ç”¨æˆ·åå’Œå¯†ç ä¸ºå¿…å¡«é¡¹
- ç‚¹å‡»ç™»å½•æŒ‰é’®åæ˜¾ç¤ºåŠ è½½åŠ¨ç”»
- é”™è¯¯æç¤ºåŒ…æ‹¬ï¼š"ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯"
- å·²ç™»å½•ç”¨æˆ·è®¿é—®ç™»å½•é¡µè‡ªåŠ¨é‡å®šå‘åˆ°é¦–é¡µ

### 3.2 æ³¨å†ŒåŠŸèƒ½

#### 3.2.1 åŠŸèƒ½æè¿°
æ”¯æŒç”¨æˆ·è‡ªåŠ©æ³¨å†Œæ–°è´¦å·ã€‚

#### 3.2.2 æ³¨å†Œæµç¨‹
1. ç”¨æˆ·ç‚¹å‡»"æ³¨å†Œæ–°è´¦å·"é“¾æ¥
2. ä½¿ç”¨å½“å‰è¾“å…¥çš„ç”¨æˆ·åå’Œå¯†ç è°ƒç”¨æ³¨å†ŒAPI
3. æ³¨å†ŒæˆåŠŸåè‡ªåŠ¨ç™»å½•
4. è·³è½¬åˆ°å·¥ä½œå°é¦–é¡µ

#### 3.2.3 æ³¨å†Œä¿¡æ¯
- è™šæ‹Ÿé‚®ç®±ï¼š`username@pmsy.com`
- é»˜è®¤å…¨åï¼šç”¨æˆ·å
- å¤´åƒURLï¼šç©ºå­—ç¬¦ä¸²

### 3.3 å…¨å±€å¸ƒå±€

#### 3.3.1 å¸ƒå±€ç»“æ„
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Top Navigation Bar                             â”‚
â”‚  [Logo] [Navigation] [Notifications] [UserMenu] â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                 â”‚
â”‚  Main Content Area                              â”‚
â”‚  (Outlet - å­é¡µé¢å†…å®¹)                          â”‚
â”‚                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 3.3.2 é¡¶éƒ¨å¯¼èˆªæ 

**LogoåŒºåŸŸ**
- æ˜¾ç¤º"PMSY"å“ç‰Œæ ‡è¯†
- ç‚¹å‡»è·³è½¬åˆ°å·¥ä½œå°é¦–é¡µ

**å¯¼èˆªèœå•**
æ ¹æ®ç”¨æˆ·è§’è‰²æƒé™åŠ¨æ€æ˜¾ç¤ºï¼š

| èœå•é¡¹ | key | å›¾æ ‡ | æƒé™æ§åˆ¶ |
|--------|-----|------|----------|
| å·¥ä½œå° | dashboard | LayoutDashboard | æ‰€æœ‰ç”¨æˆ· |
| é¡¹ç›®ç®¡ç† | projects | FolderKanban | role_permissionsé…ç½® |
| ä»»åŠ¡ä¸­å¿ƒ | tasks | CheckSquare | role_permissionsé…ç½® |
| ä¾›åº”å•† | suppliers | Users | role_permissionsé…ç½® |
| æ•°æ®åˆ†æ | analysis | BarChart2 | role_permissionsé…ç½® |
| ç³»ç»Ÿè®¾ç½® | system | Settings | role_permissionsé…ç½® |

**ç”¨æˆ·èœå•**
- ç”¨æˆ·å¤´åƒï¼ˆæ˜¾ç¤ºç”¨æˆ·åé¦–å­—æ¯ï¼‰
- ç”¨æˆ·å/é‚®ç®±æ˜¾ç¤º
- ä¸‹æ‹‰èœå•ï¼šä¸ªäººä¿¡æ¯ã€é€€å‡ºç™»å½•

**é€šçŸ¥ç»„ä»¶**
- æ˜¾ç¤ºç³»ç»Ÿé€šçŸ¥

#### 3.3.3 ç§»åŠ¨ç«¯é€‚é…
- å¯¼èˆªèœå•å˜ä¸ºæ¨ªå‘æ»šåŠ¨
- ä¿æŒæ ¸å¿ƒåŠŸèƒ½å¯ç”¨

### 3.4 å—ä¿æŠ¤è·¯ç”±

#### 3.4.1 åŠŸèƒ½æè¿°
æœªç™»å½•ç”¨æˆ·æ— æ³•è®¿é—®ç³»ç»Ÿå†…éƒ¨é¡µé¢ï¼Œè‡ªåŠ¨é‡å®šå‘åˆ°ç™»å½•é¡µã€‚

#### 3.4.2 å®ç°æ–¹å¼
- ä½¿ç”¨React Routerçš„ProtectedRouteç»„ä»¶
- æ£€æŸ¥AuthContextä¸­çš„sessionçŠ¶æ€
- æ— sessionæ—¶é‡å®šå‘åˆ°/login

---

## å››ã€æ•°æ®æ¨¡å‹

### 4.1 æ ¸å¿ƒæ•°æ®è¡¨

#### profilesï¼ˆç”¨æˆ·èµ„æ–™è¡¨ï¼‰
| å­—æ®µ | ç±»å‹ | è¯´æ˜ | çº¦æŸ |
|------|------|------|------|
| id | uuid | ä¸»é”® | å…³è”auth.users |
| username | text | ç”¨æˆ·å | å”¯ä¸€ |
| full_name | text | å…¨å | - |
| avatar_url | text | å¤´åƒURL | - |
| role | text | è§’è‰² | admin/user |
| email | text | é‚®ç®± | - |
| phone | text | ç”µè¯ | - |
| created_at | timestamptz | åˆ›å»ºæ—¶é—´ | è‡ªåŠ¨ |

#### role_permissionsï¼ˆè§’è‰²æƒé™è¡¨ï¼‰
| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| id | uuid | ä¸»é”® |
| role_key | text | è§’è‰²æ ‡è¯† |
| module_key | text | æ¨¡å—æ ‡è¯† |

### 4.2 TypeScriptç±»å‹å®šä¹‰

```typescript
interface Profile {
  id: string;
  username: string;
  full_name: string;
  avatar_url: string;
  role: 'admin' | 'user';
  email: string;
  phone: string;
  created_at: string;
}

interface AuthContextType {
  session: Session | null;
  user: User | null;
  profile: Profile | null;
  loading: boolean;
  signOut: () => Promise<void>;
}
```

---

## äº”ã€æ¥å£è§„èŒƒ

### 5.1 è®¤è¯ç›¸å…³

#### ç™»å½•
```typescript
const { error } = await supabase.auth.signInWithPassword({
  email: virtualEmail,  // username@pmsy.com
  password,
});
```

#### æ³¨å†Œ
```typescript
const { error } = await supabase.auth.signUp({
  email: virtualEmail,
  password,
  options: {
    data: {
      username: username,
      full_name: username,
      avatar_url: '',
    }
  }
});
```

#### ç™»å‡º
```typescript
await supabase.auth.signOut();
```

#### è·å–ç”¨æˆ·èµ„æ–™
```typescript
const { data, error } = await supabase
  .from('profiles')
  .select('*')
  .eq('id', userId)
  .single();
```

#### è·å–è§’è‰²æƒé™
```typescript
const { data, error } = await supabase
  .from('role_permissions')
  .select('module_key')
  .eq('role_key', profile.role);
```

---

## å…­ã€ç•Œé¢åŸå‹

### 6.1 ç™»å½•é¡µé¢

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                         â”‚
â”‚           ç™»å½•ç³»ç»Ÿ                       â”‚
â”‚                                         â”‚
â”‚     æˆ– æ³¨å†Œæ–°è´¦å·                        â”‚
â”‚                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ ç”¨æˆ·å (ä¾‹å¦‚: root)              â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ å¯†ç                             â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚           ç™»å½•                   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 6.2 å…¨å±€å¸ƒå±€

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PMSY  [å·¥ä½œå°][é¡¹ç›®ç®¡ç†][ä»»åŠ¡ä¸­å¿ƒ]...    [ğŸ””][å¤´åƒ ç”¨æˆ·å â–¼] â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                            â”‚
â”‚                                                            â”‚
â”‚                    é¡µé¢å†…å®¹åŒºåŸŸ                             â”‚
â”‚                                                            â”‚
â”‚                                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ä¸ƒã€éªŒæ”¶æ ‡å‡†

### 7.1 åŠŸèƒ½éªŒæ”¶

| éªŒæ”¶é¡¹ | éªŒæ”¶æ ‡å‡† | çŠ¶æ€ |
|--------|----------|------|
| ç™»å½•åŠŸèƒ½ | æ­£ç¡®ç”¨æˆ·åå¯†ç å¯ç™»å½•ï¼Œé”™è¯¯æç¤ºæ˜ç¡® | å·²å®ç° |
| æ³¨å†ŒåŠŸèƒ½ | æ–°ç”¨æˆ·å¯æ³¨å†Œå¹¶è‡ªåŠ¨ç™»å½• | å·²å®ç° |
| ç™»å‡ºåŠŸèƒ½ | ç‚¹å‡»é€€å‡ºåæ¸…é™¤sessionï¼Œé‡å®šå‘åˆ°ç™»å½•é¡µ | å·²å®ç° |
| å—ä¿æŠ¤è·¯ç”± | æœªç™»å½•è®¿é—®å†…éƒ¨é¡µé¢é‡å®šå‘åˆ°ç™»å½•é¡µ | å·²å®ç° |
| å¯¼èˆªæƒé™ | æ ¹æ®role_permissionsåŠ¨æ€æ˜¾ç¤ºèœå• | å·²å®ç° |
| ç”¨æˆ·ä¿¡æ¯ | ç™»å½•åæ˜¾ç¤ºæ­£ç¡®çš„ç”¨æˆ·åå’Œå¤´åƒ | å·²å®ç° |

### 7.2 æ€§èƒ½éªŒæ”¶

| éªŒæ”¶é¡¹ | æ ‡å‡† | çŠ¶æ€ |
|--------|------|------|
| ç™»å½•å“åº” | < 3ç§’ | å·²å®ç° |
| é¡µé¢åŠ è½½ | < 3ç§’ | å·²å®ç° |
| æƒé™æŸ¥è¯¢ | < 1ç§’ | å·²å®ç° |

---

## å…«ã€ä¿®è®¢è®°å½•

| ç‰ˆæœ¬ | æ—¥æœŸ | ä¿®è®¢å†…å®¹ | ä¿®è®¢äºº |
|------|------|----------|--------|
| 1.0 | 2025-02-09 | åˆå§‹ç‰ˆæœ¬ | AI Assistant |
| 2.0 | 2026-02-10 | åŒæ­¥ä»£ç å®ç°ï¼Œæ›´æ–°ç™»å½•æµç¨‹ã€å¸ƒå±€ç»“æ„ã€æƒé™æ§åˆ¶ | AI Assistant |
