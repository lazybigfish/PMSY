# 模块06：数据分析模块需求文档

## 版本信息
- **版本**: 2.0
- **更新日期**: 2026-02-10
- **状态**: 已同步代码实现（基础版）

---

## 一、模块概述

### 1.1 模块定位
数据分析模块提供项目、任务、风险等数据的统计分析和可视化展示，帮助管理者了解整体项目运行状况。

### 1.2 核心职责
- 项目状态分布统计
- 任务状态分布统计
- 风险等级分布统计
- 数据可视化图表展示
- 报表导出功能

---

## 二、用户角色与权限

### 2.1 角色定义

| 角色 | 说明 | 数据范围 |
|------|------|----------|
| 项目用户 | 普通项目成员 | 仅自己参与的项目数据 |
| 系统管理员 | 系统管理员 | 全部数据 |

### 2.2 权限矩阵

| 功能 | 项目用户 | 系统管理员 |
|------|----------|-----------|
| 查看统计图表 | ✓(自己的) | ✓(全部) |
| 导出报表 | ✓ | ✓ |

---

## 三、功能需求

### 3.1 页面头部
- **标题**: "统计分析"
- **导出报表按钮**: 导出数据报表

### 3.2 统计图表

#### 3.2.1 项目状态分布
- **图表类型**: 饼图
- **数据维度**: 未开始/进行中/已完成/已暂停
- **展示内容**: 各状态项目数量及占比

#### 3.2.2 任务状态分布
- **图表类型**: 饼图
- **数据维度**: 待办/进行中/已完成/挂起
- **展示内容**: 各状态任务数量及占比

#### 3.2.3 风险等级分布
- **图表类型**: 饼图
- **数据维度**: 低风险/中风险/高风险
- **展示内容**: 各等级风险数量及占比
- **颜色标识**: 绿色(低)/黄色(中)/红色(高)

### 3.3 图表交互
- 鼠标悬停显示详细数值
- 图例点击可隐藏/显示对应数据
- 响应式布局适配不同屏幕

---

## 四、数据模型

### 4.1 统计数据结构

```typescript
interface ProjectStats {
  name: string;      // 状态名称
  value: number;     // 数量
}

interface TaskStats {
  name: string;      // 状态名称
  value: number;     // 数量
}

interface RiskStats {
  name: string;      // 等级名称
  value: number;     // 数量
}
```

---

## 五、接口规范

### 5.1 获取统计数据

```typescript
// 获取项目状态统计
const { data: projects } = await supabase
  .from('projects')
  .select('status');

// 获取任务状态统计
const { data: tasks } = await supabase
  .from('tasks')
  .select('status, priority');

// 获取风险等级统计
const { data: risks } = await supabase
  .from('risks')
  .select('level');
```

### 5.2 数据处理

```typescript
// 项目状态统计
const processProjectStats = (data: any[]) => {
  const counts = { pending: 0, in_progress: 0, completed: 0, paused: 0 };
  data.forEach(item => { if (counts[item.status] !== undefined) counts[item.status]++; });
  return Object.keys(counts).map(key => ({ name: map[key], value: counts[key] }));
};

// 任务状态统计
const processTaskStats = (data: any[]) => {
  const counts = { todo: 0, in_progress: 0, done: 0, paused: 0 };
  data.forEach(item => { const status = item.status === 'canceled' ? 'paused' : item.status; ... });
  return Object.keys(counts).map(key => ({ name: map[key], value: counts[key] }));
};

// 风险等级统计
const processRiskStats = (data: any[]) => {
  const counts = { low: 0, medium: 0, high: 0 };
  data.forEach(item => { if (counts[item.level] !== undefined) counts[item.level]++; });
  return Object.keys(counts).map(key => ({ name: map[key], value: counts[key] }));
};
```

---

## 六、界面原型

```
┌─────────────────────────────────────────────────────────────────────┐
│ 统计分析                                            [导出报表]       │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│  ┌──────────────────────────┐    ┌──────────────────────────┐      │
│  │     项目状态分布          │    │     任务状态分布          │      │
│  │                          │    │                          │      │
│  │      [ 饼图 ]            │    │      [ 饼图 ]            │      │
│  │                          │    │                          │      │
│  │  ● 进行中 40%            │    │  ● 已完成 50%            │      │
│  │  ● 未开始 30%            │    │  ● 待办 30%              │      │
│  │  ● 已完成 20%            │    │  ● 进行中 15%            │      │
│  │  ● 已暂停 10%            │    │  ● 挂起 5%               │      │
│  └──────────────────────────┘    └──────────────────────────┘      │
│                                                                     │
│  ┌──────────────────────────┐                                      │
│  │     风险等级分布          │                                      │
│  │                          │                                      │
│  │      [ 饼图 ]            │                                      │
│  │                          │                                      │
│  │  ● 低风险 60%            │                                      │
│  │  ● 中风险 30%            │                                      │
│  │  ● 高风险 10%            │                                      │
│  └──────────────────────────┘                                      │
│                                                                     │
└─────────────────────────────────────────────────────────────────────┘
```

---

## 七、验收标准

### 7.1 功能验收

| 验收项 | 验收标准 | 状态 |
|--------|----------|------|
| 项目状态分布 | 饼图正确显示各状态占比 | 已实现 |
| 任务状态分布 | 饼图正确显示各状态占比 | 已实现 |
| 风险等级分布 | 饼图正确显示各等级占比 | 已实现 |
| 图表交互 | 悬停显示数值，图例可点击 | 已实现 |
| 导出功能 | 可导出报表 | 已实现 |

### 7.2 性能验收

| 验收项 | 标准 | 状态 |
|--------|------|------|
| 图表加载 | < 3秒 | 已实现 |
| 数据刷新 | < 2秒 | 已实现 |

---

## 八、修订记录

| 版本 | 日期 | 修订内容 | 修订人 |
|------|------|----------|--------|
| 1.0 | 2025-02-09 | 初始版本 | AI Assistant |
| 2.0 | 2026-02-10 | 同步代码实现，更新基础统计图表功能 | AI Assistant |
