# 模块07：周日报管理模块需求文档

## 版本信息
- **版本**: 2.0
- **更新日期**: 2026-02-10
- **状态**: 已同步代码实现（基础版）

---

## 一、模块概述

### 1.1 模块定位
周日报管理模块提供项目报告的创建、编辑和管理功能，支持日报和周报两种类型，帮助项目团队记录和汇报工作进展。

### 1.2 核心职责
- 报告创建与编辑
- 报告列表管理
- 报告模板支持
- 项目关联报告

---

## 二、用户角色与权限

### 2.1 角色定义

| 角色 | 说明 | 权限范围 |
|------|------|----------|
| 项目成员 | 普通项目成员 | 可创建和编辑自己项目的报告 |
| 项目经理 | 项目管理者 | 可管理项目内所有报告 |
| 系统管理员 | 系统管理员 | 可管理所有报告和模板 |

### 2.2 权限矩阵

| 功能 | 项目成员 | 项目经理 | 系统管理员 |
|------|----------|----------|-----------|
| 创建报告 | ✓ | ✓ | ✓ |
| 编辑报告 | ✓(自己的) | ✓(项目内) | ✓ |
| 删除报告 | ✓(自己的) | ✓(项目内) | ✓ |
| 查看报告 | ✓ | ✓ | ✓ |
| 配置模板 | ✗ | ✗ | ✓ |

---

## 三、功能需求

### 3.1 报告列表

#### 3.1.1 列表展示
- 显示报告标题、类型、状态、创建时间
- 支持按项目筛选
- 支持按类型筛选（日报/周报）

#### 3.1.2 报告状态
- 草稿
- 已发布

### 3.2 报告创建/编辑

#### 3.2.1 表单字段

| 字段 | 类型 | 必填 | 说明 |
|------|------|------|------|
| 报告标题 | 文本 | 是 | 报告名称 |
| 报告类型 | 单选 | 是 | 日报/周报 |
| 关联项目 | 下拉选择 | 是 | 所属项目 |
| 报告内容 | 富文本 | 是 | 报告正文 |
| 状态 | 单选 | 是 | 草稿/已发布 |

#### 3.2.2 报告编辑器
- 支持富文本编辑
- 支持从模板加载
- 支持自动保存

### 3.3 报告模板

在系统设置的报告模板Tab中配置：
- 日报模板
- 周报模板
- 模板变量支持

---

## 四、数据模型

### 4.1 核心数据表

#### reports（报告表）
| 字段 | 类型 | 说明 |
|------|------|------|
| id | uuid | 主键 |
| project_id | uuid | 项目ID |
| title | text | 报告标题 |
| type | text | 类型：daily/weekly |
| status | text | 状态：draft/published |
| content | jsonb | 报告内容 |
| created_by | uuid | 创建人ID |
| created_at | timestamptz | 创建时间 |

---

## 五、接口规范

### 5.1 获取报告列表

```typescript
const { data, error } = await supabase
  .from('reports')
  .select(`
    *,
    project:projects(name),
    creator:profiles(full_name)
  `)
  .order('created_at', { ascending: false });
```

### 5.2 创建/更新报告

```typescript
const reportData = {
  project_id,
  title,
  type,
  status,
  content,
  created_by: user.id
};

// 创建
const { error } = await supabase.from('reports').insert(reportData);

// 更新
const { error } = await supabase
  .from('reports')
  .update(reportData)
  .eq('id', id);
```

---

## 六、验收标准

### 6.1 功能验收

| 验收项 | 验收标准 | 状态 |
|--------|----------|------|
| 报告列表 | 显示报告列表，支持筛选 | 部分实现 |
| 报告创建 | 支持创建日报/周报 | 部分实现 |
| 报告编辑 | 支持富文本编辑 | 部分实现 |
| 模板支持 | 支持从模板创建 | 部分实现 |

### 6.2 性能验收

| 验收项 | 标准 | 状态 |
|--------|------|------|
| 列表加载 | < 3秒 | 已实现 |
| 编辑器加载 | < 2秒 | 已实现 |

---

## 七、修订记录

| 版本 | 日期 | 修订内容 | 修订人 |
|------|------|----------|--------|
| 1.0 | 2025-02-09 | 初始版本 | AI Assistant |
| 2.0 | 2026-02-10 | 同步代码实现，更新基础报告功能 | AI Assistant |
