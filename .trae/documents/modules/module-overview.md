# PMSY系统模块划分与拆解说明

## 版本信息
- **版本**: 2.0
- **更新日期**: 2026-02-10
- **状态**: 已同步代码实现

---

## 一、模块划分概述

本文档详细说明PMSY项目管理系统的模块划分方案，包括划分依据、模块间关系、数据流转等核心内容。

---

## 二、划分原则

### 2.1 功能关联性原则
- 将功能紧密相关的业务逻辑聚合在同一模块内
- 减少模块间的功能交叉和重复

### 2.2 业务逻辑独立性原则
- 每个模块对应明确的业务领域
- 模块内部业务闭环，对外提供标准接口

### 2.3 开发实施便利性原则
- 各模块可独立开发、测试、部署
- 支持团队并行开发

### 2.4 数据实体独立性原则
- 每个模块拥有独立的核心数据实体
- 跨模块数据通过关联表或接口交互

---

## 三、模块清单

| 序号 | 模块名称 | 模块代码 | 核心定位 | 主要用户 | 优先级 | 实现状态 |
|------|----------|----------|----------|----------|--------|----------|
| 1 | 认证与公共模块 | AUTH | 系统入口、用户认证 | 所有用户 | P0 | 已实现 |
| 2 | 工作台模块 | DASHBOARD | 项目概览、快捷入口、热点新闻 | 所有用户 | P0 | 已实现 |
| 3 | 水漫金山模块 | WATER | 热点资讯、用户社区 | 所有用户 | P0 | 已实现 |
| 4 | 项目管理模块 | PROJECT | 项目全生命周期管理 | 项目经理、团队成员 | P0 | 已实现 |
| 5 | 任务中心模块 | TASK | 任务分配与协作 | 项目经理、团队成员 | P0 | 已实现 |
| 6 | 供应商管理模块 | SUPPLIER | 供应商库管理 | 项目经理、团队成员 | P1 | 已实现 |
| 7 | 数据分析模块 | ANALYTICS | 项目数据可视化分析 | 项目经理、系统管理员 | P1 | 部分实现 |
| 8 | 周日报管理模块 | REPORT | 报告生成与管理 | 项目经理、团队成员 | P1 | 部分实现 |
| 9 | 系统管理模块 | ADMIN | 系统配置与基础数据 | 系统管理员 | P1 | 已实现 |
| 10 | 文件管理模块 | FILES | 文件上传、存储、管理 | 所有用户 | P1 | 已实现 |

---

## 四、模块间关系

### 4.1 依赖关系图

```
                    ┌──────────────────┐
                    │   认证与公共模块   │
                    │     (AUTH)       │
                    └────────┬─────────┘
                             │ 提供用户身份
                             ▼
┌──────────┐    ┌──────────┐    ┌──────────┐    ┌──────────┐
│ 工作台    │◄───│ 项目管理  │◄───│ 任务中心  │    │ 供应商   │
│ DASHBOARD│    │ PROJECT  │    │  TASK    │    │ SUPPLIER│
└────┬─────┘    └────┬─────┘    └────┬─────┘    └────┬─────┘
     │               │               │               │
     │               └───────────────┴───────────────┘
     │                           │
     │                           ▼
     │                    ┌──────────┐
     │                    │ 数据分析  │
     │                    │ANALYTICS │
     │                    └────┬─────┘
     │                         │
     │         ┌───────────────┘
     │         │
     ▼         ▼
┌──────────┐    ┌──────────┐
│ 周日报   │    │ 系统管理  │
│ REPORT   │    │  ADMIN   │
└──────────┘    └──────────┘
```

### 4.2 依赖关系说明

| 模块 | 依赖模块 | 依赖说明 |
|------|----------|----------|
| 工作台 | 认证、项目管理、任务中心 | 需要获取项目和任务统计数据 |
| 项目管理 | 认证、系统管理 | 需要用户认证和里程碑模板 |
| 任务中心 | 认证、项目管理 | 需要项目信息和功能模块数据 |
| 供应商 | 认证、项目管理 | 需要项目信息进行关联 |
| 数据分析 | 认证、项目管理、任务中心、供应商 | 需要各模块数据进行分析 |
| 周日报 | 认证、项目管理、系统管理 | 需要项目数据和模板配置 |
| 系统管理 | 认证 | 基础依赖 |
| 文件管理 | 认证 | 基础依赖，为其他模块提供文件存储服务 |

---

## 五、数据流转关系

### 5.1 数据流向图

```
┌────────────────────────────────────────────────────────────────┐
│                        数据流向说明                             │
└────────────────────────────────────────────────────────────────┘

1. 认证模块 → 所有模块
   - 提供用户身份认证信息
   - JWT Token验证
   - 用户权限信息

2. 项目管理模块 → 任务中心模块
   - 项目ID、项目名称
   - 功能模块ID
   - 项目成员信息

3. 项目管理模块 → 供应商模块
   - 项目ID
   - 项目供应商关联

4. 项目管理模块 → 数据分析模块
   - 项目进度数据
   - 里程碑状态
   - 风险数据
   - 功能模块完成情况

5. 任务中心模块 → 数据分析模块
   - 任务状态
   - 任务进度
   - 延期任务数据

6. 供应商模块 → 数据分析模块
   - 供应商进度
   - 付款数据

7. 项目管理模块 → 周日报模块
   - 项目概述数据
   - 功能模块完成情况
   - 风险数据
   - 里程碑进度

8. 任务中心模块 → 周日报模块
   - 任务完成情况
   - 进度更新记录

9. 系统管理模块 → 项目管理模块
   - 里程碑模板
   - 系统配置项

10. 系统管理模块 → 周日报模块
    - 报告模板
    - AI配置
```

### 5.2 核心数据实体关系

```
users (1) ──────< (N) project_members >────── (N) projects
                     │
                     ├──< (N) project_modules
                     ├──< (N) project_milestones >──< (N) milestone_tasks
                     ├──< (N) tasks >──< (N) task_assignees
                     ├──< (N) project_suppliers >── (N) suppliers
                     ├──< (N) risks
                     └──< (N) reports

milestone_templates (1) ───< (N) milestone_tasks (模板)
ai_providers (1) ───< (N) ai_roles
system_configs (1) ───< 全局配置
hot_news (1) ───< (N) news_comments
forum_posts (1) ───< (N) forum_replies
storage_configs (1) ───< (N) files
folders (1) ───< (N) files
```

---

## 六、接口规范

### 6.1 接口命名规范
- 使用Supabase客户端直接操作数据库
- 通过外键关系进行嵌套查询

### 6.2 响应格式规范
数据直接以TypeScript类型定义，无需额外封装。

---

## 七、权限矩阵

### 7.1 角色权限映射

| 功能 | 系统管理员 | 项目经理 | 团队成员 |
|------|-----------|----------|----------|
| 用户管理 | ✓ | ✗ | ✗ |
| 系统配置 | ✓ | ✗ | ✗ |
| 热点配置 | ✓ | ✗ | ✗ |
| 项目创建 | ✓ | ✓ | ✗ |
| 项目编辑 | ✓ | ✓(自己的) | ✗ |
| 任务创建 | ✓ | ✓ | ✓ |
| 任务分配 | ✓ | ✓ | ✗ |
| 供应商管理 | ✓ | ✓ | ✓ |
| 数据分析 | ✓(全部) | ✓(自己的) | ✓(自己的) |
| 报告生成 | ✓ | ✓ | ✓ |
| 文件上传 | ✓ | ✓ | ✓ |
| 文件下载 | ✓ | ✓ | ✓(自己的) |
| 文件删除 | ✓ | ✓(自己的) | ✓(自己的) |

### 7.2 数据可见性规则

| 数据类型 | 系统管理员 | 项目经理 | 团队成员 |
|----------|-----------|----------|----------|
| 所有项目 | ✓ | ✗ | ✗ |
| 参与的项目 | ✓ | ✓ | ✓ |
| 公开项目 | ✓ | ✓ | ✓ |
| 项目全部任务 | ✓ | ✓ | ✗ |
| 分配的任务 | ✓ | ✓ | ✓ |
| 公开任务 | ✓ | ✓ | ✓ |

---

## 八、验收标准

### 8.1 整体系统验收标准

1. **功能完整性**：所有8个模块的核心功能正常运行
2. **数据一致性**：跨模块数据流转准确无误
3. **权限控制**：角色权限严格按需求执行
4. **性能要求**：
   - 页面加载时间 < 3秒
   - 数据查询响应 < 2秒
5. **兼容性**：支持Chrome、Firefox、Edge最新版本

### 8.2 模块独立验收标准

| 模块 | 关键验收指标 | 实现状态 |
|------|-------------|----------|
| 认证模块 | 登录成功率 > 99%，Token刷新无感知 | 已实现 |
| 工作台模块 | 统计数据准确性100%，加载时间 < 3秒 | 已实现 |
| 水漫金山模块 | 热点资讯展示正常，论坛发帖功能正常 | 已实现 |
| 项目管理模块 | 功能模块支持树形管理，里程碑7阶段正常 | 已实现 |
| 任务中心模块 | 批量操作支持，状态变更实时同步 | 已实现 |
| 供应商模块 | 供应商数据与项目可见性一致 | 已实现 |
| 数据分析模块 | 图表渲染正常，数据导出正常 | 部分实现 |
| 周日报模块 | 报告编辑器功能正常 | 部分实现 |
| 系统管理模块 | 配置变更实时生效，操作日志完整 | 已实现 |
| 文件管理模块 | 文件上传下载正常，存储配额控制有效 | 已实现 |

---

## 九、文档清单

### 9.1 已交付文档
1. module-overview.md（本文档）- 模块划分说明
2. module-01-auth.md - 认证与公共模块需求文档
3. module-02-dashboard.md - 工作台模块需求文档
4. module-03-shuimanjinshan.md - 水漫金山模块需求文档
5. module-03-project.md - 项目管理模块需求文档
6. module-04-task.md - 任务中心模块需求文档
7. module-05-supplier.md - 供应商管理模块需求文档
8. module-06-analytics.md - 数据分析模块需求文档
9. module-07-report.md - 周日报管理模块需求文档
10. module-08-admin.md - 系统管理模块需求文档
11. module-10-files.md - 文件管理模块需求文档

### 9.2 核心文档
1. product_requirements_document.md - 产品需求文档
2. technical_architecture_document.md - 技术架构文档

---

## 十、修订记录

| 版本 | 日期 | 修订内容 | 修订人 |
|------|------|----------|--------|
| 1.0 | 2025-02-09 | 初始版本，完成模块划分 | AI Assistant |
| 2.0 | 2026-02-10 | 同步代码实现状态，更新模块清单、依赖关系、验收标准 | AI Assistant |
| 2.1 | 2026-02-10 | 新增水漫金山模块（热点资讯、水底探宝） | AI Assistant |
| 2.2 | 2026-02-10 | 新增文件管理模块 | AI Assistant |
