# PMSY产品需求文档（PRD）

## 版本信息
- **版本**: 2.0
- **更新日期**: 2026-02-10
- **状态**: 已同步代码实现

---

## 1. 产品概述

在线项目管理系统（PMSY）是一个综合性的项目管理平台，专注于项目全生命周期管理。系统以项目管理为核心，集成任务分配、供应商管理和系统配置等功能，为企业提供完整的项目协作解决方案。

目标用户为项目经理、团队成员、供应商管理员和系统管理员，通过系统化的项目管理流程提升项目执行效率和透明度。

---

## 2. 核心功能

### 2.1 用户角色

| 角色 | 注册方式 | 核心权限 | 数据可见范围 |
|------|----------|----------|--------------|
| 项目用户 | 管理员创建 | 创建项目、管理项目内容、分配任务、管理供应商（权限在项目内生效） | 仅可见自己参与的项目及相关数据 |
| 系统管理员 | 初始账号 | 用户管理、角色管理、系统配置 | 可见系统全部数据 |

**角色权限说明：**

- **项目用户**：系统内统一的用户角色，在项目中根据身份不同拥有相应权限
  - **项目经理**：项目创建者自动成为该项目的项目经理，拥有项目的完整管理权限
  - **团队成员**：由项目经理添加到项目中的用户，拥有项目内的操作权限
  - **角色转换**：同一用户可以在不同项目中担任不同角色

- **系统管理员**：
  - 可查看系统中所有项目、任务、供应商数据
  - 可管理用户账号、角色权限
  - 可配置系统设置、里程碑模板、AI配置、热点关键词

### 2.2 功能模块

系统包含以下主要功能模块：

1. **认证/公共模块**：用户登录、系统访问
2. **工作台模块**：项目概览、统计信息、快捷入口、今日热点、我的待办
3. **水漫金山模块**：热点资讯（历史热点查看与评论）、水底探宝（用户社区发帖互动）
4. **项目管理**：项目创建，信息管理、功能模块管理、里程碑管理、风险管理、供应商关联
5. **任务中心**：任务创建、状态管理、进度跟踪、批量操作、高级搜索
6. **供应商管理**：供应商库管理、项目关联
7. **系统管理**：用户管理、角色权限、里程碑模板、报告模板、AI配置、热点配置
8. **周日报管理**：报告编辑、报告列表
9. **文件管理**：文件上传、存储、下载、删除、文件夹管理

---

## 3. 页面详情

### 3.1 登录页面

| 功能模块 | 功能描述 |
|----------|----------|
| 登录表单 | 系统Logo和名称展示、邮箱/密码输入框、登录按钮、错误提示信息 |
| 认证处理 | 基于Supabase Auth的身份验证、登录成功后重定向到系统首页 |

### 3.2 工作台首页

| 功能模块 | 功能描述 |
|----------|----------|
| 统计卡片 | 合同总金额（作为项目经理）、风险提示、任务总数、超期未完成 |
| 今日热点 | 显示系统配置的热点新闻，支持评论功能 |
| 我的待办 | 显示当前用户的待办任务列表，按截止日期排序 |
| 快捷入口 | 新建项目、我的任务按钮 |

### 3.3 水漫金山

| 功能模块 | 功能描述 |
|----------|----------|
| 热点资讯 | 展示系统抓取的热点新闻历史记录，支持搜索、筛选、分页；卡片式布局显示标题、摘要、来源、评论数 |
| 热点详情 | 弹窗展示新闻完整内容、原文链接、评论列表；支持发布评论 |
| 水底探宝 | 用户社区论坛，列表展示帖子（含置顶/精华标识），支持分类筛选（技术分享/项目经验/问题求助/闲聊/其他） |
| 发帖功能 | 支持发布新帖，包含标题、分类、富文本内容、附件；支持编辑和删除自己的帖子 |
| 帖子详情 | 展示帖子内容和回复列表，支持引用回复、@用户、表情、图片；支持发布回复 |
| 帖子管理 | 管理员可置顶、加精、删除帖子 |

### 3.4 项目管理

| 功能模块 | 功能描述 |
|----------|----------|
| 项目列表 | 展示项目列表，支持搜索、筛选；显示序号、项目信息、客户名称、项目金额、当前阶段、进度、健康度、操作按钮 |
| 项目创建 | 填写项目名称、客户名称、项目金额、项目描述、是否公开；创建后自动初始化7个里程碑阶段 |
| 项目详情 | Tab切换展示：项目概览、功能模块、里程碑、风险、供应商、周日报 |
| 功能模块 | 树形结构展示项目功能模块，支持增删改查 |
| 里程碑 | 7个标准阶段管理，每个阶段包含必选任务，支持任务完成状态更新 |
| 风险 | 项目风险登记、列表展示、状态管理 |
| 供应商 | 项目关联的供应商展示和管理 |

### 3.5 任务中心

| 功能模块 | 功能描述 |
|----------|----------|
| 任务列表 | 列表视图/看板视图切换，显示任务标题、项目、处理人、状态、优先级、截止日期 |
| 任务创建 | 设置任务标题、描述、关联项目、关联模块、优先级、截止日期、处理人（多选）、是否公开 |
| 高级搜索 | 支持多条件组合搜索，可按字段、操作符、值进行筛选 |
| 批量操作 | 支持多选任务进行批量状态变更、批量删除 |
| 任务状态 | 未开始、进行中、已完成、已暂停、已取消 |

### 3.6 供应商管理

| 功能模块 | 功能描述 |
|----------|----------|
| 供应商库 | 卡片式布局展示供应商列表，支持搜索 |
| 供应商创建 | 填写供应商名称、联系人、电话、邮箱、地址、描述、状态 |
| 供应商详情 | 展示供应商基本信息、参与项目数、累计合同金额、项目清单 |

### 3.7 系统管理

| 功能模块 | 功能描述 |
|----------|----------|
| 用户管理 | 用户列表展示、创建用户、编辑用户、重置密码、删除用户 |
| 角色权限 | 角色列表、权限配置 |
| 里程碑模板 | 7个标准阶段模板管理 |
| 报告模板 | 周日报模板配置 |
| AI配置 | AI提供商配置、AI角色预设 |
| 热点配置 | 热点新闻关键词配置（仅管理员） |

### 3.8 文件管理

| 功能模块 | 功能描述 |
|----------|----------|
| 文件列表 | 列表/网格视图展示文件，支持搜索、分类筛选、排序 |
| 文件上传 | 支持单文件/多文件上传，显示上传进度，支持拖拽上传 |
| 文件下载 | 支持文件下载，右键菜单快速下载 |
| 文件删除 | 支持文件删除（软删除），支持批量删除 |
| 文件夹管理 | 支持创建文件夹，文件夹导航，面包屑路径 |
| 存储配额 | 显示存储空间使用情况，配额限制控制 |
| 文件分类 | 自动识别文件类型（文档/图片/视频/音频/压缩包/其他） |
| 操作日志 | 记录文件上传、下载、删除等操作日志 |

---

## 4. 核心流程

### 4.1 用户登录流程

1. 访问系统进入登录页面
2. 输入邮箱和密码进行身份验证
3. 登录成功后重定向到系统首页
4. 登录后在所有页面右上角显示用户名称

### 4.2 项目创建流程

1. 点击"新建项目"按钮
2. 填写项目基本信息（名称、客户、金额、描述、是否公开）
3. 提交创建，系统自动：
   - 创建项目记录
   - 将创建者设为项目经理
   - 初始化7个里程碑阶段
   - 为每个阶段创建对应的必选任务
4. 跳转到项目详情页

### 4.3 任务创建流程

1. 点击"新建任务"按钮
2. 选择关联项目（联动加载功能模块）
3. 填写任务信息（标题、描述、优先级、截止日期）
4. 选择处理人（可多选，第一个为主要负责人）
5. 设置是否公开
6. 保存后跳转到任务详情页

---

## 5. 用户界面设计

### 5.1 设计风格

- **主色调**：靛蓝色（#4F46E5）搭配白色背景
- **辅助色**：灰色（#F3F4F6）用于卡片背景
- **按钮样式**：圆角矩形，主要操作为实心按钮，次要操作为边框按钮
- **字体**：系统默认字体，标题16-24px，正文14px
- **布局风格**：顶部导航栏 + 内容区域的管理后台布局
- **图标风格**：使用Lucide React线性图标

### 5.2 响应式设计

采用桌面端优先的设计方案，适配1280x768及以上分辨率。

---

## 6. 数据模型

### 6.1 核心实体

- **profiles**: 用户资料表
- **projects**: 项目表
- **project_members**: 项目成员表
- **project_modules**: 功能模块表
- **project_milestones**: 项目里程碑表
- **milestone_tasks**: 里程碑任务表
- **tasks**: 任务表
- **task_assignees**: 任务处理人表
- **suppliers**: 供应商表
- **project_suppliers**: 项目供应商关联表
- **risks**: 风险表
- **reports**: 报告表
- **ai_providers**: AI提供商表
- **ai_roles**: AI角色表
- **hot_news**: 热点新闻表
- **news_comments**: 新闻评论表
- **system_configs**: 系统配置表
- **forum_posts**: 论坛帖子表
- **forum_replies**: 论坛回复表
- **files**: 文件表
- **folders**: 文件夹表
- **storage_configs**: 存储配置表
- **file_operation_logs**: 文件操作日志表
- **storage_quotas**: 存储配额表

---

## 7. 非功能需求

### 7.1 性能需求

- 页面加载时间 < 3秒
- 数据查询响应 < 2秒
- 列表支持分页加载
- 文件上传支持进度显示

### 7.2 安全需求

- 基于Supabase Auth的身份认证
- Row Level Security (RLS) 数据权限控制
- 敏感操作需二次确认
- 文件上传类型和大小限制
- 文件存储访问权限控制

### 7.3 兼容性需求

- 支持Chrome 90+、Firefox 88+、Edge 90+
- 响应式设计，支持1280x768及以上分辨率
- 支持常见文件格式上传和下载

---

## 8. 修订记录

| 版本 | 日期 | 修订内容 | 修订人 |
|------|------|----------|--------|
| 1.0 | 2025-02-09 | 初始版本 | AI Assistant |
| 2.0 | 2026-02-10 | 同步代码实际实现，更新功能描述、页面详情、数据模型 | AI Assistant |
| 2.1 | 2026-02-10 | 新增水漫金山模块（热点资讯、水底探宝论坛） | AI Assistant |
| 2.2 | 2026-02-10 | 新增文件管理模块 | AI Assistant |
