# 项目规则文档

## 1. 需求管理

需求变更流程：
1. 更新需求文档 → `.agent/records/当天日期/`
2. 用户确认需求文档
3. 根据确认结果调整

## 2. 开发规范

### 2.1 功能开发
- 完成后必须自测
- 优先抽象复用，避免重复代码
- **完成后必须重启前端服务**，确保用户可以立即验证

### 2.2 UI 规范
- 使用 TailwindCSS
- **弹窗必须使用统一组件**：`Modal` / `ModalForm` / `ConfirmModal`，禁止独立实现遮罩层
  - ❌ 禁止：`<div className="fixed inset-0 bg-black/50">...</div>`
  - ✅ 正确：`<Modal isOpen={isOpen} onClose={handleClose}>...</Modal>`
  - 详见：`.agent/records/2026-02-15/弹窗使用规范.md`

### 2.3 代码质量
- 避免不必要的对象复制
- 减少嵌套，提前返回
- 使用线程安全的并发控制
- 超过 60 行抽象为函数/模块

### 2.4 数据库变更（重要）

| 操作 | 规范 |
|-----|------|
| 新增表/字段 | `IF NOT EXISTS` 确保幂等；设置默认值避免冲突 |
| 修改字段 | 评估影响；提供迁移脚本 |
| 删除字段/表 | 确认无依赖；先备份 |
| 数据初始化 | `ON CONFLICT DO NOTHING`；逻辑放迁移脚本 |
| 字段命名 | 与前端保持一致；外键命名统一 |

**部署前检查**：幂等性 / 新环境可运行 / 数据安全 / 前后端字段一致

## 3. 测试规范

- 项目需有独立测试目录，存放用例、数据、脚本、结果

## 4. 文档规范

### 4.1 修复记录
- 更新 `.agent/records/当天日期/项目开发日报.md`

### 4.2 文档拆分

| 类型 | 文件名 | 用途 |
|-----|-------|------|
| 日报 | `项目开发日报.md` | 每日概览 |
| 功能修复 | `{功能}修复记录.md` | 详细修复记录 |
| 模块迁移 | `{模块}迁移记录.md` | 迁移记录 |
| 类型修复 | `类型修复记录.md` | 类型修复 |

### 4.3 格式要求
- 格式统一，中文标题
